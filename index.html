<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>مدرسه الفبا</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            touch-action: manipulation;
            background-color: #f0f9ff;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .card { transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .lesson-card {
            background: linear-gradient(135deg, #38bdf8, #6366f1);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        .lesson-card.locked {
            background: linear-gradient(135deg, #BDBDBD, #9E9E9E);
            cursor: not-allowed;
            filter: grayscale(80%);
        }
        .letter-bubble {
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            touch-action: none;
            transition: transform 0.1s, opacity 0.2s;
            position: relative;
            z-index: 10;
            width: 50px;
            height: 50px;
            min-width: 50px;
            min-height: 50px;
        }
        .letter-bubble.dragging { 
            opacity: 0.8; 
            transform: scale(1.1); 
            cursor: grabbing;
            z-index: 1000;
            position: absolute;
            pointer-events: none;
        }
        .letter-bubble:active { cursor: grabbing; }
        .drop-zone { 
            border: 2px dashed #94a3b8;
            min-width: 50px;
            min-height: 50px;
            width: 50px;
            height: 50px;
            transition: all 0.2s;
            background-color: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px;
            border-radius: 0.5rem;
        }
        .drop-zone.drag-over {
            background-color: #bfdbfe;
            border-color: #3b82f6;
        }
        .drop-zone.filled {
            background-color: #dcfce7;
            border-color: #22c55e;
            color: #15803d;
            animation: pop-in 0.3s ease-out;
        }
        @keyframes pop-in {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); }
          20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
          40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        #success-modal.show > div { transform: scale(1); }
        .choice-btn.correct { animation: correct-pulse 0.5s ease; }
        .choice-btn.incorrect { animation: shake 0.5s ease; }
        @keyframes correct-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background-color: #4ade80; }
            100% { transform: scale(1); }
        }
        .drag-clone {
            position: absolute;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.8;
            user-select: none;
            -webkit-user-select: none;
        }
        .back-button-icon {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            width: 48px;
            height: 48px;
        }
        .back-button-icon:hover {
            transform: scale(1.1);
        }
        .back-button-icon img {
            width: 36px;
            height: 36px;
        }
        #build-word-game, #choice-game, #picture-guess-game, #fill-blank-game, #dictation-game {
            max-width: 100%;
            overflow-x: hidden;
        }
        #drop-zones {
            max-width: 100%;
            overflow-x: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px 0;
            flex-wrap: wrap;
        }
        #letter-bubbles {
            max-width: 100%;
            overflow-x: hidden;
        }
        .lesson-title-header {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        @media (max-width: 640px) {
            .drop-zone, .letter-bubble {
                width: 40px;
                height: 40px;
                min-width: 40px;
                min-height: 40px;
                font-size: 1.25rem;
            }
            #drop-zones {
                gap: 1px;
            }
        }
        .completed-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #10b981;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .section-card-container {
            position: relative;
        }
        .creator-info {
            text-align: center;
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 1rem;
            padding: 0.5rem;
        }
        .page {
            display: none;
            flex-direction: column;
            width: 100%;
            max-width: 100%;
            min-height: 100vh;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .page.active {
            display: flex;
        }
        .modal {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            display: none;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        /* --- تغییرات برای بخش روان‌خوانی --- */
        #read-game {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        #read-word {
            text-align: center;
        }
        #read-aloud-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* --- استایل برای جمله توصیه --- */
        .lesson-advice {
            text-align: center;
            font-size: 0.875rem; /* text-sm */
            color: #94a3b8; /* slate-400 */
            margin-top: 0.5rem;
            font-weight: 300;
        }
        /* --- استایل های جدید برای Gamification --- */
        .stars-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 1rem;
        }
        .star-icon {
            width: 24px;
            height: 24px;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2));
        }
        .achievement-card {
            background-color: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
        }
        .achievement-card.locked {
            opacity: 0.5;
            border-color: #94a3b8;
        }
        .achievement-card.unlocked {
            border-color: #fbbf24;
            background-color: #fef3c7;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { box-shadow: 0 0 5px #fbbf24; }
            to { box-shadow: 0 0 20px #fbbf24; }
        }
        .trophy-icon {
            width: 40px;
            height: 40px;
        }
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: #f1f5f9;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .stats-badge {
            background-color: #dbeafe;
            color: #1d4ed8;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        /* --- استایل برای صفحه املا --- */
        /* FIX: Only apply flex display when the element is NOT hidden */
        #dictation-game:not(.hidden) {
            text-align: center;
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #dictation-text {
            font-size: 1.75rem; /* text-2xl */
            font-weight: bold;
            margin: 2rem 0;
            min-height: 3rem;
            padding: 1rem;
            background-color: #f1f5f9;
            border-radius: 1rem;
            border: 2px dashed #94a3b8;
            line-height: 1.8;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #dictation-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-top: 1rem;
            direction: ltr;
        }
        .dictation-nav-btn {
            background-color: #6366f1;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .dictation-nav-btn:hover {
            background-color: #4f46e5;
        }
        .dictation-nav-btn:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
        }
        #dictation-counter {
            font-size: 1.125rem; /* text-lg */
            font-weight: bold;
            color: #475569;
        }
    </style>
</head>
<body class="text-gray-800">
    <div id="app-container" class="w-full max-w-md mx-auto">
        <!-- --- صفحه فعال‌سازی --- -->
        <div id="activation-screen" class="page active">
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
                <h2 class="text-2xl font-bold text-center text-sky-700 mb-6">فعال‌سازی برنامه</h2>
                <p class="text-center text-gray-600 mb-4">لطفاً کد فعال‌سازی خود را وارد کنید</p>
                <input type="text" id="activation-code-input" class="w-full p-3 border border-gray-300 rounded-lg mb-4 text-center font-mono" placeholder="XXXX-XXXX-XXXX">
                <button id="activate-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-full mb-4">فعال‌سازی</button>
                <button id="demo-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-full">ورود به نسخه دمو</button>
                <p id="activation-message" class="text-center mt-4 min-h-[1.5em]"></p>
            </div>
            <div class="creator-info">ایده و تولید: احسان شمسی</div>
        </div>
        <!-- --- صفحه منوی اصلی --- -->
        <div id="main-menu" class="page">
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
                <header class="text-center mb-4">
                    <h1 class="text-5xl font-bold text-sky-700">مدرسه الفبا</h1>
                    <p class="text-sky-600 text-lg mt-2"><img src="sun.png" class="w-10 h-10 mx-auto" alt="آفتاب"></p>
                    <!-- نمایش تعداد ستاره‌ها -->
                    <div id="main-menu-stars" class="stars-display mt-4">
                        <img src="star.png" class="star-icon" alt="ستاره">
                        <span id="star-count" class="text-2xl font-bold text-yellow-500">0</span>
                    </div>
                </header>
                <div id="lessons-grid" class="space-y-4 mb-6"></div>
                <!-- دکمه‌های جدید تابلو امتیازات و دستاوردها -->
                <div class="flex gap-4">
                    <button id="show-leaderboard-btn" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-full">
                        🏆 تابلو امتیازات
                    </button>
                    <button id="show-achievements-btn" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-full">
                        🎯 دستاوردها
                    </button>
                </div>
            </div>
        </div>
        <!-- --- صفحه تابلو امتیازات --- -->
        <div id="leaderboard-screen" class="page">
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
                <header class="flex items-center justify-between mb-6">
                    <button id="back-to-main-from-leaderboard" class="back-button-icon">
                        <img src="back_arrow.png" alt="بازگشت">
                    </button>
                    <h2 class="text-2xl font-bold text-amber-500">🏆 تابلو امتیازات</h2>
                    <div class="w-12"></div>
                </header>
                <div class="space-y-4">
                    <div class="leaderboard-item">
                        <span>تعداد ستاره‌ها:</span>
                        <span id="lb-total-stars" class="font-bold text-yellow-500">0</span>
                    </div>
                    <div class="leaderboard-item">
                        <span>دروس کامل شده:</span>
                        <span id="lb-completed-lessons" class="font-bold text-green-500">0/20</span>
                    </div>
                    <div class="leaderboard-item">
                        <span>تمرین‌های انجام شده:</span>
                        <span id="lb-total-exercises" class="font-bold text-blue-500">0</span>
                    </div>
                    <div class="leaderboard-item">
                        <span>کلمات ساخته شده:</span>
                        <span id="lb-words-built" class="stats-badge">0</span>
                    </div>
                    <div class="leaderboard-item">
                        <span>کلمات خوانده شده:</span>
                        <span id="lb-words-read" class="stats-badge">0</span>
                    </div>
                </div>
            </div>
            <div class="creator-info">ایده و تولید: احسان شمسی</div>
        </div>
        <!-- --- صفحه دستاوردها --- -->
        <div id="achievements-screen" class="page">
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
                <header class="flex items-center justify-between mb-6">
                    <button id="back-to-main-from-achievements" class="back-button-icon">
                        <img src="back_arrow.png" alt="بازگشت">
                    </button>
                    <h2 class="text-2xl font-bold text-purple-500">🎯 دستاوردها</h2>
                    <div class="w-12"></div>
                </header>
                <div id="achievements-list" class="space-y-4">
                    <!-- دستاوردها به صورت پویا اینجا قرار می‌گیرند -->
                </div>
            </div>
            <div class="creator-info">ایده و تولید: احسان شمسی</div>
        </div>
        <!-- --- صفحه بخش‌های درس --- -->
        <div id="lesson-sections-screen" class="page">
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md">
                <header class="flex items-center justify-between mb-6">
                    <button id="back-to-main-menu" class="back-button-icon">
                        <img src="back_arrow.png" alt="بازگشت">
                    </button>
                    <div class="flex-1 text-center">
                        <h2 id="sections-lesson-title" class="text-2xl font-bold text-sky-700 lesson-title-header"></h2>
                        <p class="lesson-advice">توصیه می‌شود از بخش «روان‌خوانی» شروع کنید.</p>
                    </div>
                    <div class="w-12"></div>
                </header>
                <div id="sections-grid" class="space-y-4"></div>
            </div>
            <div class="creator-info">ایده و تولید: احسان شمسی</div>
        </div>
        <!-- --- صفحه بازی --- -->
        <div id="game-screen" class="page">
            <!-- ✅ تغییر جدید: افزودن flex و flex-col برای چیدمان عمودی -->
            <div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-md flex flex-col">
                <header class="flex items-center justify-between mb-6">
                    <button id="back-to-sections" class="back-button-icon">
                        <img src="back_arrow.png" alt="بازگشت">
                    </button>
                    <h2 id="game-lesson-title" class="text-xl font-bold text-sky-700 lesson-title-header"></h2>
                    <div class="w-12"></div>
                </header>
                <div id="word-image-container" class="mb-6 h-32 flex items-center justify-center"></div>
                <div id="build-word-game">
                    <div id="drop-zones" class="flex flex-row-reverse flex-wrap justify-center items-center gap-2 mb-6" dir="ltr"></div>
                    <div id="letter-bubbles" class="flex justify-center items-center flex-wrap gap-3 p-4 bg-sky-50 rounded-lg min-h-[80px]"></div>
                </div>
                <div id="choice-game" class="hidden">
                    <p class="text-xl text-gray-600 mb-6">کدام کلمه درست است؟</p>
                    <div id="choice-options" class="grid grid-cols-1 gap-4"></div>
                </div>
                <div id="picture-guess-game" class="hidden">
                    <p class="text-xl text-gray-600 mb-6">کدام کلمه مربوط به تصویر است؟</p>
                    <div id="picture-guess-options" class="grid grid-cols-1 gap-4"></div>
                </div>
                <div id="fill-blank-game" class="hidden">
                    <p class="text-2xl font-bold text-gray-800 mb-6" id="sentence-blank"></p>
                    <div id="fill-blank-options" class="grid grid-cols-1 gap-4"></div>
                </div>
                <div id="dictation-game" class="hidden">
                    <div id="dictation-text">متن املا اینجا نمایش داده می‌شود.</div>
                    <div id="dictation-controls">
                        <button id="prev-dictation-btn" class="dictation-nav-btn">◀ قبلی</button>
                        <span id="dictation-counter">املا 1 از 1</span>
                        <button id="next-dictation-btn" class="dictation-nav-btn">بعدی ▶</button>
                    </div>
                    <button id="finish-dictation-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full mt-6">
                        پایان املا
                    </button>
                </div>
                <div id="dynamic-read-game-container"></div>
            </div>
            <div class="creator-info">ایده و تولید: احسان شمسی</div>
        </div>
        <!-- --- مودال موفقیت --- -->
        <div id="success-modal" class="modal">
            <div class="bg-white rounded-2xl shadow-2xl p-8 text-center scale-95 transition-transform duration-300">
                <div class="text-7xl mb-4"><img src="star.png" class="w-16 h-16 mx-auto" alt="ستاره"></div>
                <h3 class="text-4xl font-bold text-green-500 mb-2">آفرین!</h3>
                <p id="modal-stars-earned" class="text-2xl text-yellow-500 font-bold mb-2">+1 ⭐</p>
                <p id="modal-word" class="text-2xl text-gray-700 mb-6"></p>
                <button id="next-exercise-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full">بعدی</button>
            </div>
        </div>
        <!-- --- مودال تکمیل درس --- -->
        <div id="lesson-complete-modal" class="modal">
            <div class="bg-white rounded-2xl shadow-2xl p-8 text-center">
                <div class="text-7xl mb-4"><img src="hat.png" class="w-16 h-16 mx-auto" alt="کلاه"></div>
                <h3 class="text-4xl font-bold text-amber-500 mb-4">بخش کامل شد!</h3>
                <p class="text-xl text-gray-600 mb-8">عالی بود! این بخش را با موفقیت تمام کردی.</p>
                <button id="back-to-sections-from-complete" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full">بازگشت به درس</button>
            </div>
        </div>
        <!-- --- مودال هشدار اشتراک‌گذاری --- -->
        <div id="share-warning-modal" class="modal">
            <div class="bg-white rounded-2xl shadow-2xl p-6 text-center max-w-sm w-full">
                <h3 class="text-2xl font-bold text-red-500 mb-4">هشدار!</h3>
                <p class="text-gray-700 mb-6">لطفاً از به اشتراک‌گذاری کد فعال‌سازی خودداری کنید. در غیر این صورت، دسترسی شما به برنامه غیرفعال خواهد شد.</p>
                <button id="close-warning-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full">متوجه شدم</button>
            </div>
        </div>
        <!-- --- مودال درس قفل شده --- -->
        <div id="locked-lesson-modal" class="modal">
            <div class="modal-content">
                <h3 class="text-2xl font-bold text-amber-500 mb-4">🔒 درس قفل است</h3>
                <p class="text-gray-700 mb-4">این درس در نسخه دمو در دسترس نیست. لطفاً کد فعال‌سازی خود را وارد کنید تا به تمام دروس دسترسی پیدا کنید.</p>
                <input type="text" id="modal-activation-code" placeholder="کد فعال‌سازی" class="w-full p-3 border border-gray-300 rounded-lg mb-4 text-center font-mono">
                <button id="modal-activate-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full mb-3">
                    فعال‌سازی
                </button>
                <button id="modal-demo-btn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full mb-3">
                    بازگشت به نسخه دمو
                </button>
                <button id="close-locked-modal-btn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full">
                    لغو
                </button>
                <p id="modal-activation-message" class="text-center mt-4 min-h-[1.5em]"></p>
            </div>
        </div>
    </div>
    <script>
        // --- DATA ---
        const activationCodes = [
            "TEST-CODE-0001", "TEST-CODE-0002", "TEST-CODE-0003", "TEST-CODE-0004", "TEST-CODE-0005",
            "A1B2-C3D4-E5F6", "G7H8-I9J0-K1L2", "M3N4-O5P6-Q7R8", "S9T0-U1V2-W3X4", "Y5Z6-A7B8-C9D0",
            "K2L3-M4N5-O6P7", "Q8R9-S0T1-U2V3", "W4X5-Y6Z7-A8B9", "C0D1-E2F3-G4H5", "I6J7-K8L9-M0N1",
            "O2P3-Q4R5-S6T7", "U8V9-W0X1-Y2Z3", "A4B5-C6D7-E8F9", "G0H1-I2J3-K4L5", "M6N7-O8P9-Q0R1",
            "S2T3-U4V5-W6X7", "Y8Z9-A0B1-C2D3", "E4F5-G6H7-I8J9", "K0L1-M2N3-O4P5", "Q6R7-S8T9-U0V1",
            "W2X3-Y4Z5-A6B7", "C8D9-E0F1-G2H3", "I4J5-K6L7-M8N9", "O0P1-Q2R3-S4T5", "U6V7-W8X9-Y0Z1",
            "A2B3-C4D5-E6F7", "G8H9-I0J1-K2L3", "M4N5-O6P7-Q8R9", "S0T1-U2V3-W4X5", "Y6Z7-A8B9-C0D1",
            "E2F3-G4H5-I6J7", "K8L9-M0N1-O2P3", "Q4R5-S6T7-U8V9", "W0X1-Y2Z3-A4B5", "C6D7-E8F9-G0H1",
            "I2J3-K4L5-M6N7", "O8P9-Q0R1-S2T3", "U4V5-W6X7-Y8Z9", "A0B1-C2D3-E4F5", "G6H7-I8J9-K0L1",
            "M2N3-O4P5-Q6R7", "S8T9-U0V1-W2X3", "Y4Z5-A6B7-C8D9", "E0F1-G2H3-I4J5", "K6L7-M8N9-O0P1",
            "Q2R3-S4T5-U6V7", "W8X9-Y0Z1-A2B3", "C4D5-E6F7-G8H9", "I0J1-K2L3-M4N5", "O6P7-Q8R9-S0T1",
            "U2V3-W4X5-Y6Z7", "A8B9-C0D1-E2F3", "G4H5-I6J7-K8L9", "M0N1-O2P3-Q4R5", "S6T7-U8V9-W0X1",
            "Y2Z3-A4B5-C6D7", "E8F9-G0H1-I2J3", "K4L5-M6N7-O8P9", "Q0R1-S2T3-U4V5", "W6X7-Y8Z9-A0B1",
            "C2D3-E4F5-G6H7", "I8J9-K0L1-M2N3", "O4P5-Q6R7-S8T9", "U0V1-W2X3-Y4Z5", "A6B7-C8D9-E0F1",
            "G2H3-I4J5-K6L7", "M8N9-O0P1-Q2R3", "S4T5-U6V7-W8X9", "Y0Z1-A2B3-C4D5", "E6F7-G8H9-I0J1",
            "K2L3-M4N5-O6P7", "Q8R9-S0T1-U2V3", "W4X5-Y6Z7-A8B9", "C0D1-E2F3-G4H5", "I6J7-K8L9-M0N1",
            "O2P3-Q4R5-S6T7", "U8V9-W0X1-Y2Z3", "A4B5-C6D7-E8F9", "G0H1-I2J3-K4L5", "M6N7-O8P9-Q0R1",
            "S2T3-U4V5-W6X7", "Y8Z9-A0B1-C2D3", "E4F5-G6H7-I8J9", "K0L1-M2N3-O4P5", "Q6R7-S8T9-U0V1",
            "W2X3-Y4Z5-A6B7", "C8D9-E0F1-G2H3", "I4J5-K6L7-M8N9", "O0P1-Q2R3-S4T5", "U6V7-W8X9-Y0Z1",
            "A2B3-C4D5-E6F7", "G8H9-I0J1-K2L3", "M4N5-O6P7-Q8R9", "S0T1-U2V3-W4X5", "Y6Z7-A8B9-C0D1"
        ];
        const lessons = [
             {
                id: 1, title: "درس اول: آ ا ، بـ ب", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "آب" }, { type: 'build', word: "بابا" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "بابا", options: ["بابا", "بایا", "آبا"] }, { type: 'choice', correct: "آب", options: ["آب", "اب", "اَب"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "آب" }, { type: 'read', word: "بابا" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "آب", correct: "آب", options: ["آب", "شیر", "ماه"] }, { type: 'pictureGuess', image: "بابا", correct: "بابا", options: ["بابا", "مادر", "برادر"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "من ___ نوشیدم چون تشنہ بودم.", correct: "آب", options: ["آب", "بابا", "ماه"] }, 
                        { type: 'fillBlank', sentence: "__ مرا دوست دارد", correct: "بابا", options: ["بابا", "درخت", "خانه"] },
                        { type: 'fillBlank', sentence: "در فنجان ___ ریخته بودم.", correct: "آب", options: ["آب", "سرکه", "خاک"] },
                        { type: 'fillBlank', sentence: "با ___ بازی کردم.", correct: "بابا", options: ["بابا", "دوست", "ماشین"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "آ - آب - با - بابا " },
                        { type: 'dictation', text: "آب - بابا _ با _ b - آ - بابا آب " }
                    ] }
                ]
            },
            {
                id: 2, title: "درس دوم: اَ َ ، د", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "باد" }, { type: 'build', word: "داد" }, { type: 'build', word: "ادب" }, { type: 'build', word: "آباد" }, { type: 'build', word: "بَد" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "آباد", options: ["آباد", "آبات", "اداب"] }, { type: 'choice', correct: "داد", options: ["داد", "داب", "باد"] }, { type: 'choice', correct: "ادب", options: ["ادب", "ادد", "ابد"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "باد" }, { type: 'read', word: "ادب" }, { type: 'read', word: "آباد" }, { type: 'read', word: "داد" }, { type: 'read', word: "بَد" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "باد", correct: "باد", options: ["باد", "باران", "آفتاب"] }, { type: 'pictureGuess', image: "داد", correct: "داد", options: ["داد", "گفت", "آمد"] }, { type: 'pictureGuess', image: "ادب", correct: "ادب", options: ["ادب", "آب", "باد"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ وزید و برگ‌ها را به هوا برد.", correct: "باد", options: ["باد", "باران", "ماه"] }, 
                        { type: 'fillBlank', sentence: "___ زدم چون سر و صدا زیاد بود.", correct: "داد", options: ["داد", "گفت", "آمد"] },
                        { type: 'fillBlank', sentence: "در جمع مهمانان، باید ___ را رعایت کنیم.", correct: "ادب", options: ["ادب", "آب", "باد"] },
                        { type: 'fillBlank', sentence: "شهر ___ زیبا است.", correct: "آباد", options: ["آباد", "باد", "داد"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "بابا - آب - اَ - آ - بـ - بَ - بـَ " },
                        { type: 'dictation', text: " اَدَب - آ - آداب - آب - با - بابا - داد" }
                    ] }
                ]
            },
            {
                id: 3, title: "درس سوم: مـ م ، سـ س", unlocked: true,
                sections: [
                     { title: "ترکیب صداها", exercises: [ { type: 'build', word: "اسب" }, { type: 'build', word: "سبد" }, { type: 'build', word: "آمد" }, { type: 'build', word: "بادام" }, { type: 'build', word: "داس" }, { type: 'build', word: "سام" } ] },
                     { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "بادام", options: ["بادام", "بادَم", "بابام"] }, { type: 'choice', correct: "اسب", options: ["اسب", "اصب", "اثب"] }, { type: 'choice', correct: "سبد", options: ["سبد", "سمد", "صبد"] }, { type: 'choice', correct: "آمد", options: ["آمد", "امد", "اَمد"] } ] },
                     { title: "روان‌خوانی", exercises: [ { type: 'read', word: "آباد" }, { type: 'read', word: "آمد" }, { type: 'read', word: "اسب" }, { type: 'read', word: "سبد" }, { type: 'read', word: "بادام" }, { type: 'read', word: "داس" } ] },
                     { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "اسب", correct: "اسب", options: ["اسب", "گربه", "ماشین"] }, { type: 'pictureGuess', image: "سبد", correct: "سبد", options: ["سبد", "کیف", "دست"] }, { type: 'pictureGuess', image: "آمد", correct: "آمد", options: ["آمد", "رفت", "خوابید"] } ] },
                     { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "در مزرعه، ___ دوید و به ما  نزدیک شد.", correct: "اسب", options: ["اسب", "گربه", "ماشین"] }, 
                        { type: 'fillBlank', sentence: "میوه‌ها را داخل ___ گذاشتم تا به خانه ببرم.", correct: "سبد", options: ["سبد", "کیف", "دست"] },
                        { type: 'fillBlank', sentence: "امروز بابا از کار زود ____.", correct: "آمد", options: ["آمد", "رفت", "خوابید"] },
                        { type: 'fillBlank', sentence: "از درخت ____ چیدم.", correct: "بادام", options: ["بادام", "سنگ", "باد"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "داد - دام - م - مـ - ما - مَ - ماد - " },
                        { type: 'dictation', text: "ما - بام - بَم - بادام - دام - باد - آمَد " },
                        { type: 'dictation', text: "باد - آمَد - بام - بادام - آدَم - بابا - سام - اَسب - داماد با اَسب آمَد." },
                        { type: 'dictation', text: "بادام - آمَد - بَد - دَم - دام - باد آمَد - بابا بادام داد - داماد آمَد." }
                    ] }
                ]
            },
            { 
                id: 4, title: "درس چهارم: او و ، تـ ت", unlocked: true,
                sections: [
                     { title: "ترکیب صداها", exercises: [ { type: 'build', word: "توت" }, { type: 'build', word: "دوست" }, { type: 'build', word: "دست" }, { type: 'build', word: "تاب" }, { type: 'build', word: "سوت" }, { type: 'build', word: "بود" } ] },
                     { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "دست", options: ["دست", "دثت", "دسط"] }, { type: 'choice', correct: "دوست", options: ["دوست", "دوثت", "دست"] }, { type: 'choice', correct: "تاب", options: ["تاب", "باب", "تاپ"] }, { type: 'choice', correct: "توت", options: ["توت", "تود", "طوت"] } ] },
                     { title: "روان‌خوانی", exercises: [ { type: 'read', word: "توت" }, { type: 'read', word: "سوت" }, { type: 'read', word: "دوست" }, { type: 'read', word: "دست" }, { type: 'read', word: "بود" }, { type: 'read', word: "تاب" } ] },
                     { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "توت", correct: "توت", options: ["توت", "سیب", "نان"] }, { type: 'pictureGuess', image: "دوست", correct: "دوست", options: ["دوست", "پدر", "خانه"] }, { type: 'pictureGuess', image: "دست", correct: "دست", options: ["دست", "پا", "چشم"] } ] },
                     { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "در باغ، میوه‌ی خوشمزه‌ی ___ را چیدم.", correct: "توت", options: ["توت", "شیر", "نان"] }, 
                        { type: 'fillBlank', sentence: "____ خوبم همیشه کمکم می کند.", correct: "دوست", options: ["دوست", "سیب", "خانه"] },
                        { type: 'fillBlank', sentence: "با ___ به مادرم سلام کردم.", correct: "دست", options: ["دست", "پا", "چشم"] },
                        { type: 'fillBlank', sentence: "در فضای باز ___ کشیدم.", correct: "سوت", options: ["سوت", "تاب", "بود"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "تا - توت - اَسب - داماد - بادام - دام - امَد - سَبَد - داد" },
                        { type: 'dictation', text: "بابا - بادام - آب - سوت - سام - بابا آمَد - " },
                        { type: 'dictation', text: "سوت - سام - تام - بام - بابا بادام داد - داماد با سَبَد توت آمَد." },
                        { type: 'dictation', text: "دَست - سوت - سام - بو - سود - بود - مو  - دود -  او با اَسب آمد. تاب - دوست" }
                    ] }
                ] 
            },
            { 
                id: 5, title: "درس پنجم: ر ، نـ ن", unlocked: true,
                sections: [
                     { title: "ترکیب صداها", exercises: [ { type: 'build', word: "انار" }, { type: 'build', word: "نان" }, { type: 'build', word: "باران" }, { type: 'build', word: "مادر" }, { type: 'build', word: "برادر" }, { type: 'build', word: "نَر" } ] },
                     { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "انار", options: ["انار", "عنار", "آنار"] }, { type: 'choice', correct: "باران", options: ["باران", "یاران", "بارن"] }, { type: 'choice', correct: "مادر", options: ["مادر", "مادار", "مادب"] } ] },
                     { title: "روان‌خوانی", exercises: [ { type: 'read', word: "انار" }, { type: 'read', word: "نان" }, { type: 'read', word: "باران" }, { type: 'read', word: "مادر" }, { type: 'read', word: "برادر" }, { type: 'read', word: "نَر" } ] },
                     { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "انار", correct: "انار", options: ["انار", "سیب", "آب"] }, { type: 'pictureGuess', image: "نان", correct: "نان", options: ["نان", "آب", "ماه"] }, { type: 'pictureGuess', image: "باران", correct: "باران", options: ["باران", "باد", "آفتاب"] } ] },
                     { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "صبحانه‌ام را با یک تکه ___ خوردم.", correct: "نان", options: ["نان", "آب", "ماه"] }, 
                        { type: 'fillBlank', sentence: "وقتی ___ آمد، همه زیر چتر رفته بودند.", correct: "باران", options: ["باران", "باد", "آفتاب"] },
                        { type: 'fillBlank', sentence: "___ مرا به مدرسه برد.", correct: "مادر", options: ["مادر", "پدر", "برادر"] },
                        { type: 'fillBlank', sentence: "در خانه با ___ بازی کردم.", correct: "برادر", options: ["برادر", "خواهر", "پدر"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "نـ - ن - نان - نا - نش - ما - مامان - بابا - تاب " },
                        { type: 'dictation', text: "مادَر - سارا - دار - داد - اَبرو - دَرس - سَرد - آرام " },
                        { type: 'dictation', text: "مادَر آمَد - مادَر با سَبَد  آمَد - مَرد - دَر - دار - دَست - دَما " },
                        { type: 'dictation', text: "بَرادَر با آَسب آمَد. - مادَر آرام آمَد. - سارا بَرادَر دارَد. - اَبر آمَد - باران- آسمان - نَم نَم - اَنار- دندان " }
                    ] }
                ] 
            },
            {
                id: 6, title: "درس ششم: ایـ یـ ی ای ، ز", unlocked: true,
                sections: [
                     { title: "ترکیب صداها", exercises: [ { type: 'build', word: "ایران" }, { type: 'build', word: "سیب" }, { type: 'build', word: "میز" }, { type: 'build', word: "زیبا" }, { type: 'build', word: "بازی" } ] },
                     { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "میز", options: ["میز", "میض", "میظ"] }, { type: 'choice', correct: "زیبا", options: ["زیبا", "ذیبا", "ظیبا"] }, { type: 'choice', correct: "ایران", options: ["ایران", "عیران", "اران"] } ] },
                     { title: "روان‌خوانی", exercises: [ { type: 'read', word: "ایران" }, { type: 'read', word: "سیب" }, { type: 'read', word: "میز" }, { type: 'read', word: "زیبا" }, { type: 'read', word: "بازی" }, { type: 'read', word: "آزاد" } ] },
                     { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "سیب", correct: "سیب", options: ["سیب", "گل", "ماه"] }, { type: 'pictureGuess', image: "میز", correct: "میز", options: ["میز", "صندلی", "تشک"] }, { type: 'pictureGuess', image: "ایران", correct: "ایران", options: ["ایران", "عراق", "ارمنستان"] } ] },
                     { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ خوردم چون گرسنه بودم.", correct: "سیب", options: ["سیب", "گل", "ماه"] }, 
                        { type: 'fillBlank', sentence: "روی ____ لیوان آب را گذاشتم.", correct: "میز", options: ["میز", "صندلی", "تشک"] },
                        { type: 'fillBlank', sentence: "پارک بسیار ___ بود.", correct: "زیبا", options: ["زیبا", "سنگ", "کثیف"] },
                        { type: 'fillBlank', sentence: "در ___ شرکت کردم.", correct: "بازی", options: ["بازی", "سیب", "چای"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "انار - اسب - دندان - آبان - من - ما " },
                        { type: 'dictation', text: "زَن - مَرد - باران - آسمان - نان - دَرس - دارَد - ای - ایـ - ی - یـ - سیب - بیدار" },
                        { type: 'dictation', text: "بیدار - سیب - ایستاد - ایران - ایرانی - اَمیر - برمی دارَد - سَرد - - سرباز - سرما - آزاد - زمین  - زیبا " },
                        { type: 'dictation', text: "سرباز - سرد - زیبا - ایران - ایرانی - ایرانی آزاد - ایران سرسبز است . - ایران ازاد است. - ما ایران را دوست داریم." }
                    ] }
                ]
            },
            {
                id: 7, title: "درس هفتم: اِ ـِ ـﻪ ﻪ ، شـ ش", unlocked: true,
                sections: [
                     { title: "ترکیب صداها", exercises: [ { type: 'build', word: "شانه" }, { type: 'build', word: "تراش" }, { type: 'build', word: "آش" }, { type: 'build', word: "امشب" }, { type: 'build', word: "ستاره" } ] },
                     { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "شانه", options: ["شانه", "سانه", "شامه"] }, { type: 'choice', correct: "تراش", options: ["تراش", "طراش", "تدراس"] }, { type: 'choice', correct: "ستاره", options: ["ستاره", "سطاره", "ثتاره"] } ] },
                     { title: "روان‌خوانی", exercises: [ { type: 'read', word: "شانه" }, { type: 'read', word: "تراش" }, { type: 'read', word: "آش" }, { type: 'read', word: "امشب" }, { type: 'read', word: "ستاره" }, { type: 'read', word: "ماشین" } ] },
                     { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "شانه", correct: "شانه", options: ["شانه", "دست", "پا"] }, { type: 'pictureGuess', image: "ستاره", correct: "ستاره", options: ["ستاره", "ماه", "خورشید"] }, { type: 'pictureGuess', image: "تراش", correct: "تراش", options: ["تراش", "قیچی", "دستمال"] } ] },
                     { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "____ را شستم تا تمیز شود .", correct: "دست", options: ["شانه", "دست", "پا"] }, 
                        { type: 'fillBlank', sentence: "در آسمان ___ دیدم.", correct: "ستاره", options: ["ستاره", "زمین", "سنگ"] },
                        { type: 'fillBlank', sentence: "مدادم را با ___ تراشیدم.", correct: "تراش", options: ["تراش", "قیچی", "دستمال"] },
                        { type: 'fillBlank', sentence: "___ گرم بود.", correct: "آش", options: ["آش", "سیب", "شکر"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "اِمام - ساده - دانه - مِداد - اِنسان - تازه - دبِستان - مدرِسه " },
                        { type: 'dictation', text: "شب - شیر- اش - تراش - شانه - نامه ای - شانه ای - دانه ای - ستاره ای " },
                        { type: 'dictation', text: "او سیتاره را به مادرش نیشان داد. - شب بود. اَمین ستاره را در آسمان دید. - اَمین مِداد دارد. - مِداد من زیبا است." },
                        { type: 'dictation', text: "آش سرد بود. - با تراش مِداد را تراشیدم. - مادرم زیبا است. - بابا را دوست دارم. " }
                    ] }
                ]
            },
            {
                id: 8, title: "درس هشتم : یـ ی ، اُ ـُ", unlocked: true,
                sections: [
                     { title: "ترکیب صداها", exercises: [ { type: 'build', word: "امید" }, { type: 'build', word: "بُرد" }, { type: 'build', word: "سُرمه" }, { type: 'build', word: "کُشت" }, { type: 'build', word: "مُژه" } ] },
                     { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "امید", options: ["امید", "عمید", "امیت"] }, { type: 'choice', correct: "سُرمه", options: ["سُرمه", "سورمه", "صُرمه"] } ] },
                     { title: "روان‌خوانی", exercises: [ { type: 'read', word: "امید" }, { type: 'read', word: "بُرد" }, { type: 'read', word: "سُرمه" }, { type: 'read', word: "مُژه" }, { type: 'read', word: "اُرْدَک" } ] },
                     { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "امید", correct: "امید", options: ["امید", "خاطره", "عشق"] }, { type: 'pictureGuess', image: "سُرمه", correct: "سُرمه", options: ["سُرمه", "خط", "دور"] }, { type: 'pictureGuess', image: "بُرد", correct: "بُرد", options: ["بُرد", "آورد", "فرستاد"] } ] },
                     { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ دارم که فردا بهتر خواهد شد.", correct: "امید", options: ["امید", "خاطره", "عشق"] }, 
                        { type: 'fillBlank', sentence: "چشم ___ کشیدم تا زیبا شود.", correct: "سُرمه", options: ["سُرمه", "سرکه", "دور"] },
                        { type: 'fillBlank', sentence: "او مسابقه را ____.", correct: "بُرد", options: ["بُرد", "آورد", "فرستاد"] },
                        { type: 'fillBlank', sentence: "___ کنار چشم است .", correct: "مُژه", options: ["مُژه", "ماهی", "قایق"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "بویِ یاس – مویِ مَن – مِیمون – مِیدان – مَریَم" },
                        { type: 'dictation', text: "اُردو – بُرد – بُز - مَردُم – مُراد – دُرُست – اُستان – اُتو – سُرسُره" },
                        { type: 'dictation', text: "دایی یاسر از یزد می آید. - میمون در سایه نشسته است . - از بیرون بوی یاس می آیَد. - یاسین رویَش را می شویَد." },
                        { type: 'dictation', text: "مُدیرِ دبستان ، دانشِ آموزان را به اُردو بُرد. - مَردُم ایران در مبارزه با دشمنان می میرند. - شیر برای رُشد بدن مناسب است. - اُمید دانش آموزِ ممتاز دبستان شُد." }
                    ] }
                ]
            },
            {
                id: 9, title: "درس نهم: کـ ک ، و ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "کتاب" }, { type: 'build', word: "کمر" }, { type: 'build', word: "وزنه بردار" }, { type: 'build', word: "داور" }, { type: 'build', word: "میوه" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "کتاب", options: ["کتاب", "کتَب", "کتپ"] }, { type: 'choice', correct: "داور", options: ["داور", "دارر", "ساور"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "کتاب" }, { type: 'read', word: "وزن" }, { type: 'read', word: "داور" }, { type: 'read', word: "وزنه بردار" }, { type: 'read', word: "میوه" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "کتاب", correct: "کتاب", options: ["کتاب", "دفتر", "ماشین"] }, { type: 'pictureGuess', image: "وزنه بردار", correct: "وزنه بردار", options: ["وزنه بردار", "درخت", "داور"] }, { type: 'pictureGuess', image: "داور", correct: "داور", options: ["داور", "وزنه بردار", "میوه"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ خواندم تا دانش بیشتری کسب کنم.", correct: "کتاب", options: ["کتاب", "کفش", "ماشین"] }, 
                        { type: 'fillBlank', sentence: "___ سوت شروع بازی را زد .", correct: "داور", options: ["داور", "وزنه بردار", "ماه"] },
                        { type: 'fillBlank', sentence: "___ پوشیدم و به مدرسه رفتم.", correct: "کفش", options: ["کفش", "پا", "نمک"] },
                        { type: 'fillBlank', sentence: "___ وزنه را بالای سر برد.", correct: "وزنه بردار", options: ["وزنه بردار", "اسب", "داور"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "کَبوتر – کودک – کاسه – کباب – کتاب - کُرسی – مِشکی – سِرکه – بِرکه – شَک – شِکَر – شُکر – شِکایَت - نَمَک – کَدو – تاریک – نمکدان" },
                        { type: 'dictation', text: "مِسواک – وَرزِش – سَواد – وَرزش کار- می شَوَد – مَشوِرَت" },
                        { type: 'dictation', text: "داور به سمت دروازه می رَوَد. - ورزش کار ورزش می کند. - آن وانِت میوِه می آوَرَد. - کودک واکسن می زند." },
                        { type: 'dictation', text: "ای کاش من کبوتر بودم. - اکبر کاردستی درست می کند. - کوسه ترسناک است. - اُردک در برکه شنا می کند." }
                    ] }
                ]
            },
            {
                id: 10, title: "درس دهم : پـ پ ، گـ گ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "گاو" }, { type: 'build', word: "سگ" }, { type: 'build', word: "پدر" }, { type: 'build', word: "پا" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "سگ", options: ["سگ", "سک", "بگ"] }, { type: 'choice', correct: "پدر", options: ["پدر", "پسر", "کدر"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "سگ" }, { type: 'read', word: "گاو" }, { type: 'read', word: "پدر" }, { type: 'read', word: "پا" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "گاو", correct: "گاو", options: ["نمک", "گاو", "کبوتر"] }, { type: 'pictureGuess', image: "پدر", correct: "پدر", options: ["پدر", "مادر", "برادر"] }] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "در باغ ___ دیدم.", correct: "سگ", options: ["لاله", "ماه", "سگ"] }, 
                        { type: 'fillBlank', sentence: "___ مرا به مدرسه برد.", correct: "پدر", options: ["پدر", "مادر", "برادر"] },
                        { type: 'fillBlank', sentence: "____ به ما شیر می دهد.", correct: "گاو", options: ["گاو", "ماه", "گل"] },
                        { type: 'fillBlank', sentence: "با ___ راه رفتم.", correct: "پا", options: ["پا", "دست", "سر"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "پَر – پَرواز – پَروَرِش – پاک – پوشید – پرستو – توپ – پَروانه" },
                        { type: 'dictation', text: "گُرگ – پدر بُزُرگ – گَرم – گاو – گاری – مادر بزرگ – بزرگ" },
                        { type: 'dictation', text: "پدر کت پوشید. - شاپرک پر کشید. - پرنده در آسمان پرواز می کند. - پارسا توپ را پرت کرد. - پری با پنیر پیتزا می پزد." },
                        { type: 'dictation', text: "مادر بزرگ نرگس در گرگان زندگی می کند. - انگور در تابستان می رسد. - یگانه گرسنه است و گریه می کند. - آموزگار دانش آموزان را به گردش می برد." }
                    ] }
                ]
            },
            {
                id: 11, title: "درس یازدهم : فـ ف ، خـ خ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "درخت" }, { type: 'build', word: "آدم برفی" }, { type: 'build', word: "خرس" }, { type: 'build', word: "رودخانه" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "رودخانه", options: ["رودجانه", "رودخانه", "رودانه"] }, { type: 'choice', correct: "خرس", options: ["خرس", "جرس", "حرس"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "رودخانه" }, { type: 'read', word: "ادم برفی" }, { type: 'read', word: "خرس" }, { type: 'read', word: "درخت" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "درخت", correct: "درخت", options: ["درخت", "خرس", "برف"] }, { type: 'pictureGuess', image: "ادم برفی", correct: "آدم برفی", options: ["آدم برفی", "رود", "خرس"] }, { type: 'pictureGuess', image: "برف", correct: "برف", options: ["برف", "درخت", "ماه"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "من به ___ آب دادم.  ", correct: "درخت", options: ["درخت", "خرس", "هوا"] }, 
                        { type: 'fillBlank', sentence: "___ امد.", correct: "برف", options: ["برف", "خرس", "درخت"] },
                        { type: 'fillBlank', sentence: "___ شیرین است . ", correct: "خرما", options: ["خرما", "آب", "برف"] },
                        { type: 'fillBlank', sentence: "در شمال ___ اجاره کردم.", correct: "خانه", options: ["خانه", "زمین", "دریا"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "خَر – خِرس – خُروس – خنده – خاک – خمیده – خَراب – خانواده" },
                        { type: 'dictation', text: "برف – کیف – آفتاب – دفتر – پفک - رفت – آفرین – فرشته – فانوس – نَفت" },
                        { type: 'dictation', text: "فرید با برف آدم برفی درست می کند. - فرشته در کیفش دفتر و کتاب فارسی دارد. - پفک و نوشابه برای بدن مفید نیستند. - افسانه و پدرش به مسافرت رفتند. - فرزانه درباره ی آزمون فردا فکر می کرد." },
                        { type: 'dictation', text: "استاد مراد با میخ و تخته تخت می سازد. - خانواده ی خانم مدیر به کنار رودخانه رفتند. - خانه ی خرگوش زیر درخت است. - شاخ گوزن شکسته است. - خدا بخشنده است." }
                    ] }
                ]
            },
            {
                id: 12, title: "درس دوازدهم : قـ ق ، لـ ل", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "لاله" }, { type: 'build', word: "لیوان" }, { type: 'build', word: "گل" }, { type: 'build', word: "قند" }, { type: 'build', word: "قوری" }, { type: 'build', word: "قایق" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "گل", options: ["گل", "حوای", "هلو"] }, { type: 'choice', correct: "لیوان", options: ["لیوان", "قند", "لاله"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "لاله" }, { type: 'read', word: "لیوان" }, { type: 'read', word: "قوری" }, { type: 'read', word: "گل" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "لاله", correct: "لاله", options: ["لاله", "لیوان", "ماه"] }, { type: 'pictureGuess', image: "قند", correct: "قند", options: ["قند", "آب", "برف"] }, { type: 'pictureGuess', image: "قوری", correct: "قوری", options: ["قوری", "قند", "لیوان"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ خیلی زیبا است.", correct: "لاله", options: ["لاله", "زمین", "لیوان"] }, 
                        { type: 'fillBlank', sentence: "روی دریا ___ دیدم.", correct: "قایق", options: ["قایق", "قند", "گل"] },
                        { type: 'fillBlank', sentence: "در قندان ___ نبود.", correct: "قند", options: ["قند", "گل", "قوری"] },
                        { type: 'fillBlank', sentence: "او به من ___ زیبایی داد .", correct: "گل", options: ["گل", "قایق", "درخت"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "قوری – قاشُق – قند – قدَم – قُرآن – قو – بشُقاب – اُتاق - قَشنگ – bَرق – آقا – قاب – قادر – قُدرت – قَوی – وَقتی" },
                        { type: 'dictation', text: "وقتی به رودخانه رسیدم قوی قشنگی را دیدم. - پدر وقت نماز قرآن را برداشت . - قاشق روی بشقاب است. - قوری روی سماور است. - اگر قوی باشم در مسابقه برنده می شوم. - قرآن کتاب خدا است." },
                        { type: 'dictation', text: "گل – فیل – بال – لاله – لباس – لب – لازم – لبخند - لانه - ناله - پرتقال – زلال – بلال – میلاد - شالیزار - الفبا" },
                        { type: 'dictation', text: "بلبل کنار گل است. - گل لبخند روی لب دارد. - رودخانه آب زلال و سالمی دارد. - خاله لیلا در کتلت فلفل می ریزد. - لانه ی لک لک روی درخت است. - میلاد وقتی به کلاس آمد سلام کرد. - فیل خیلی بزرگ است." }
                    ] }
                ]
            },
            {
                id: 13, title: "درس سیزدهم: جـ ج  ، و استثنا", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "جوجه" }, { type: 'build', word: "جارو" }, { type: 'build', word: "خورشید" }, { type: 'build', word: "نوک" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "جوجه", options: ["جوجه", "چوجه", "خوجه"] }, { type: 'choice', correct: "خورشید", options: ["خرشید", "خورسید", "خورشید"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "جوجه" }, { type: 'read', word: "جارو" }, { type: 'read', word: "خورشید" }, { type: 'read', word: "نوک" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "جارو", correct: "جارو", options: ["جارو", "دو", "خورشید"] }, { type: 'pictureGuess', image: "خورشید", correct: "خورشید", options: ["خورشید", "اتاق", "کلاس"] }, { type: 'pictureGuess', image: "نوک", correct: "نوک", options: ["نوک", "موتور", "خوش"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ من بزرگ شد . ", correct: "جوجه", options: ["جوجه", "خورشید", "خوش"] }, 
                        { type: 'fillBlank', sentence: "____ بسیار میدرخشد.", correct: "خورشید", options: ["خورشید", "دریا", "سقف"] },
                        { type: 'fillBlank', sentence: "با ____ از زمین دانه برمی دارد. ", correct: "نوک", options: ["نوک", "تند", "کمر"] },
                        { type: 'fillBlank', sentence: "من ___ را خوردم . ", correct: "خوراک", options: ["خوراک", "خورشید", "جارو"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "جوجه – گنج – جارو – جواب – سجده – مجید – برج – جوراب - برنج – خجالت – خنجر – نارنجی – مسجد – گنجشک – تجربه - رجب – جاری – مجلس – جلسه – نجات – جنگ – جام – جان" },
                        { type: 'dictation', text: "خوش – خورشید – خوراک - دو – تو – مو تور – خوردن – نوک – کادو – مانتو- پالتو – نو – نوروز – پیانو – تکواندو – خوردنی – برخورد" },
                        { type: 'dictation', text: "جوجه کنار درخت برنج را برمی دارد. - گنج آن جا زیر پل مخفی شده است. - جشن الفبا جالب و سرگرم کننده بود. - جناب آقای مجاور - آموزگار باتجربه ای است. - جنگل پر از جانوران بزرگ است. - من با مداد رنگی نارنجی پرتقال کشیدم." },
                        { type: 'dictation', text: "ابتدای سال نو را نوروز می گوییم. خورشید در اسمان می درخشد. - موتور به جدول کنار خیابان برخورد کرد. - مونا در پلو نمک ریخت. - من خوراک لوبیا را برای شام می خورم. - امین کادوی خود را باز کرد." }
                    ] }
                ]
            },
            {
                id: 14, title: "درس چهاردهم: ه‍ ‍ه‍ ‍ه ه ، چـ چ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "چشم" }, { type: 'build', word: "آهو" }, { type: 'build', word: "چوب" }, { type: 'build', word: "ماه" }, { type: 'build', word: "هلو" }] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "چشم", options: ["چشم", "چسم", "پشم"] }, { type: 'choice', correct: "ماه", options: ["ماه", "ماهـ", "ماهی"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "ماه" }, { type: 'read', word: "چشم" }, { type: 'read', word: "آهو" }, { type: 'read', word: "هلو" }, { type: 'read', word: "چوب" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "چشم", correct: "چشم", options: ["خرس", "چشم", "ماه"] }, { type: 'pictureGuess', image: "هلو", correct: "هلو", options: ["هلو", "چوب", "آهو"] }, { type: 'pictureGuess', image: "چوب", correct: "چوب", options: ["چوب", "اتاق", "چشم"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "در جنگل ___ را دیدم .", correct: "آهو", options: ["ماه", "آهو", "پارو"] }, 
                        { type: 'fillBlank', sentence: "میز از جنس ___ است.", correct: "چوب", options: ["چوب", "ماه", "چشم"] },
                        { type: 'fillBlank', sentence: "در حیاط ___ پرورش دادیم.", correct: "هلو", options: ["هلو", "هدیه", "دهان"] },
                        { type: 'fillBlank', sentence: "___ در آسمان شب بسیار زیبا است . ", correct: "ماه", options: ["ماه", "خورشید", "زمین"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "آهو – ماه – نه - مهر – مهربان – هدایت – کوه - کوهستان – کلاه – مهتاب – سهراب – میهن – ماهر – هنر – فهیمه – می فهمد – می دهد – هادی – هدیه – هر – شهر – هلو – ناهار – نهنگ – مهین – ده – هفت – هشت – همیشه – هنوز – هرگز – همسایه" },
                        { type: 'dictation', text: "در زمستان هوا همیشه سرد است. - هر شب ستاره ها را در کنار ماه می بینم. نباید هرگز همسایه را آزار دهیم. - کوه های زیادی در کوهستان است. - هنوز هم کلاسی هایم را فراموش نکرده ام. - مهر یکی از ماه های پاییز است." },
                        { type: 'dictation', text: "چراگاه – چرا – چاه – چرخ – چون – چتر – چوب – مچ – پرچم  - چادر – چپ – چیز – چسب – چاپ – چند – چاقو – چابک – کچل - چک – چه – پارچه – پارچ – چشم – چاله – چانه – چرخید – - چرخاند – می چکد – چکمه – چرم – هیچ – چلو کباب – چهار " },
                        { type: 'dictation', text: "چشم چپم آسیب دیده است. مادر پارچه را قیچی کرد و با آن چادر دوخت. چهار چرخ ماشین می چرخد. چوپان گوسفندان را به چراگاه می برد. باران روی چتر می چکد. ستاره در آسمان شب چشمک می زند." }
                    ] }
                ]
            },
            {
                id: 15, title: "درس پانزدهم: ژ ، خوا", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "ژاله" }, { type: 'build', word: "منیژه" }, { type: 'build', word: "پژمرده" }, { type: 'build', word: "خواهر" }, { type: 'build', word: "خواب" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "ژاله", options: ["زاله", "راله", "ژاله"] }, { type: 'choice', correct: "پژمرده", options: ["پژمرده", "بژمرده", "پسمرده"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "ژاله" }, { type: 'read', word: "منیژه" }, { type: 'read', word: "پژمرده" }, { type: 'read', word: "خواب" }, { type: 'read', word: "خواهر" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "ژاله", correct: "ژاله", options: ["ژاله", "پژمرده", "خواب"] }, { type: 'pictureGuess', image: "پژمرده", correct: "پژمرده", options: ["پژمرده", "کیف", "جارو"] }, { type: 'pictureGuess', image: "خواهر", correct: "خواهر", options: ["خواهر", "خواب", "منیژه"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "____ به گل ها آب داد.", correct: "ژاله", options: ["ژاله", "خار", "پژمرده"] }, 
                        { type: 'fillBlank', sentence: "___ به ژاله کمک کرد . ", correct: "منیژه ", options: ["منیژه", "گل", "ساسان"] },
                        { type: 'fillBlank', sentence: "این گل ___ شده است.", correct: "پژمرده", options: ["پژمرده", "ژاله", "خواب"] },
                        { type: 'fillBlank', sentence: "شب باید زود به ___ رفت .", correct: "خواب", options: ["خواب", "پژمرده", "ژاله"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "ژاله – بیژن – پژمرده – مژده – منیژه – ژاکت – ماژیک – آژیر – اژدها – نژاد – ژامبون – آژانس – اورژانس – مُژه – مژدگانی" },
                        { type: 'dictation', text: "ژاله با ماژیک روی تخته وایت برد می نویسد. مژه ی چشم مژده سیاه است. ماشین آتش نشانی آژیر می کشد. اگر به گل ها آب ندهیم ، آنها پژمرده می شوند. پژمان موهای ژولیده ای دارد. وقتی مادر بیمار شد با اورژانس تماس گرفتم." },
                        { type: 'dictation', text: "خواهر – خواب – می خواهد – خواهش – خواستن – خوابیدن - گیاه خوار – می خواند – خواندن – تخت خواب – خواستگار  - درخواست" },
                        { type: 'dictation', text: "پدر هرشب برای من و خواهرم کتاب داستان می خواند. بسیاری از جانوران در جنگل گوشت خوار هستند. من از مادر خواهش کردم تا روی تخت خواب عروسک ببرم. خوابیدن روی چمن بسیار جالب بود." }
                    ] }
                ]
            },
            {
                id: 16, title: "درس شانزدهم: تشدید ـّ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "بنّا" }, { type: 'build', word: "کفّاش" }, { type: 'build', word: "تشکّر" }, { type: 'build', word: "نجّار" }, { type: 'build', word: "اوّل" }, { type: 'build', word: "دکّان" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "بنّا", options: ["بنّا", "بنا", "بانّا"] }, { type: 'choice', correct: "کفّاش", options: ["کفّاش", "کفاش", "کففاش"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "بنّا" }, { type: 'read', word: "دکّان" }, { type: 'read', word: "کفّاش" }, { type: 'read', word: "اوّل" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "بنّا", correct: "بنّا", options: ["بنّا", "کفّاش", "نجّار"] }, { type: 'pictureGuess', image: "نجّار", correct: "نجّار", options: ["نجّار", "کفّاش", "اوّل"] }, { type: 'pictureGuess', image: "کفّاش", correct: "کفّاش", options: ["کفّاش", "نجّار", "بنّا"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "____ خانه میسازد. ", correct: "بنّا", options: ["بنّا", "کفّاش", "نجّار"] }, 
                        { type: 'fillBlank', sentence: "___ میز و وسایل چوبی میسازد.", correct: "نجّار", options: ["نجّار", "بنّا", "کفّاش"] },
                        { type: 'fillBlank', sentence: "____ کفش  میدوزد.", correct: "کفّاش", options: ["کفّاش", "بنّا", "نجّار"] },
                        { type: 'fillBlank', sentence: "از او ____ کردم که کمکم کرد. ", correct: "تشکّر", options: ["تشکّر", "خواستم", "گفتم"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "بنّا – نقّاش – کفّاش – اهمیّت – تشکّر –نجّار – بچّه ها" },
                        { type: 'dictation', text: "اوّل – امّا – مکّه – سکّه – دکّان – بقّالی – شدّت – ملّت – دقّت" },
                        { type: 'dictation', text: "نقّاش روی دیوار با دقّت نقّاشی می کند. نجّار تخته ها را ارّه می کند. بچّه های کلاس اوّل دبستان کتاب فارسی می خوانند. کودک سکّه های خود را در قلّک می ریزد. من به مدرسه رفتم امّا امین نیامد." }
                    ] }
                ]
            },
            {
                id: 17, title: "درس هفدهم: صـ ص ، ذ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "صابون" }, { type: 'build', word: "صدف" }, { type: 'build', word: "اذان" }, { type: 'build', word: "ذرّت" }, { type: 'build', word: "صورتی" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "صابون", options: ["صابون", "سابون", "طابون"] }, { type: 'choice', correct: "ذرّت", options: ["ذرّت", "زرت", "ظّرت"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "صابون" }, { type: 'read', word: "صدف" }, { type: 'read', word: "اذان" }, { type: 'read', word: "ذرّت" }, { type: 'read', word: "صورتی" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "صابون", correct: "صابون", options: ["صابون", "صدف", "سبد"] }, { type: 'pictureGuess', image: "ذرّت", correct: "ذرّت", options: ["ذرّت", "صورتی", "اذان"] }, { type: 'pictureGuess', image: "صورتی", correct: "صورتی", options: ["صورتی", "صبر", "صدا"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "دستم دستم را با ___ شستم.", correct: "صابون", options: ["صابون", "کیف", "تور"] }, 
                        { type: 'fillBlank', sentence: "در ساحل دریا ___ پیدا کردم .", correct: "صدف", options: ["صدف", "آب", "صابون"] },
                        { type: 'fillBlank', sentence: "من در مسجد ___ گفتم.", correct: "اذان", options: ["اذان", "ذرّت", "صدف"] },
                        { type: 'fillBlank', sentence: "رنگ لباس دوستم ____ بود .", correct: "صورتی", options: ["صورتی", "توری", "صابون"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "قصّه – صبر – صابون – صدف – صدا – صورت – صورتی - تصویر – مخصوص – صاف – صندوق – صابر – نصب - فصل – فاصله – صف – شصت – صد – وصل – اصل" },
                        { type: 'dictation', text: "مادر بزرگ قصّه ی صندوقچه ی جواهرات را خواند. مروارید در دل صدف است. وقتی بهار از راه می رسد ، صدای پرندگان در همه جا می پیچد. مینا دست و صورتش را با آب و صابون می شوید. صد دو تا صفر دارد. در خیابان اصلی یک تصادف شدید رخ داده است." },
                        { type: 'dictation', text: "گذشته – لذّت – لذیذ – ذرّه – ذرّه بین – ذکر – آذر – اذان –دلپذیر –نذری – می گذارم – گذاشت – زیرگذر – رهگذر – بذر –ذرّت – پذیرایی – جذّاب – جاذبه – جذب – ذوب" },
                        { type: 'dictation', text: "مادر با یک ناهار لذیذ از مهمان ها پذیرایی کرد. کشاورز بذر های ذرّت را در زمین می پاشد. مهر ، آبان و آذر ماه های فصل پاییز است. پدر به هنگام اذان ذکر می گوید. ذرّه های ریز را می شود زیر ذرّه بین دید." }
                    ] }
                ]
            },
            {
                id: 18, title: "درس هجدهم: عـ ـعـ ـع ع ، ثـ ث", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "ساعت" }, { type: 'build', word: "عصا" }, { type: 'build', word: "عبادت" }, { type: 'build', word: "ثانیه" }, { type: 'build', word: "مبعث" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "ساعت", options: ["ساعت", "سات", "صاعت"] }, { type: 'choice', correct: "عصا", options: ["عصا", "اَصا", "عسا"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "ساعت" }, { type: 'read', word: "عصا" }, { type: 'read', word: "عبادت" }, { type: 'read', word: "ثانیه" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "ساعت", correct: "ساعت", options: ["ساعت", "عصا", "ثابت"] }, { type: 'pictureGuess', image: "عصا", correct: "عصا", options: ["عصا", "عقاب", "مزرعه"] }, { type: 'pictureGuess', image: "ثانیه", correct: "ثانیه", options: ["ثانیه", "آثار", "کوثر"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "روی دیوار اتاق من ____ وجود دارد.", correct: "ساعت", options: ["ساعت", "عصا", "عادت"] }, 
                        { type: 'fillBlank', sentence: "پدربزرگ به کمک ___ راه میرود.", correct: "عصا", options: ["عصا", "ثانیه", "کاسه"] },
                        { type: 'fillBlank', sentence: "او در وقت نماز ____ می کند.", correct: "عبادت", options: ["عبادت", "دعوا", "علی"] },
                        { type: 'fillBlank', sentence: "عقربه ___- شمار خیلی سریع جا به جا میشود .", correct: "ثانیه", options: ["ثانیه", "خانه", "خواب"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "علی – معلّم – ساعت – معنی – عبارت – معصومه – سعید – عصا" },
                        { type: 'dictation', text: "معلّم جمع کردن عدد ها را به ما می آموزد. شمع های جشن تولّد علی به تعداد سن او بود. سعدی شاعر بزرگ ایرانی است. عقربه ی ساعت سریع نمی چرخد." },
                        { type: 'dictation', text: "کعبه خانه ی خدا است. پدر بعد از نماز دعا می خواند. با مسواک می توانیم لثه را تمیز کنیم. خوردن میوه های مفید مانند سیب ، باعث سلامتی می شود.ایرانی شجاع و دلیر است." },
                        { type: 'dictation', text: "در بازدید از موزه ی ایران آثار باستانی را دیدیم. ثریّا امسال در کلاس اوّل دبستان ثبت نام می کند. عقربه ی ثانیه شمار ساعت خیلی سریع می چرخد. کیف سارا کثیف شد. روزی که پیامبر برگزیده شد مبعث نام دارد." }
                    ] }
                ]
            },
            {
                id: 19, title: "درس نوزدهم: حـ ح ، ضـ ض", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [ { type: 'build', word: "حوله" }, { type: 'build', word: "حلزون" }, { type: 'build', word: "صبح" }, { type: 'build', word: "حوض" }, { type: 'build', word: "مریض" } ] },
                    { title: "کلمه‌یابی", exercises: [ { type: 'choice', correct: "حوله", options: ["حوله", "هوله", "حول"] }, { type: 'choice', correct: "حلزون", options: ["حلزون", "هلزون", "حلزان"] }, { type: 'choice', correct: "مریض", options: ["مریض", "مریز", "مریظ"] } ] },
                    { title: "روان‌خوانی", exercises: [ { type: 'read', word: "حوله" }, { type: 'read', word: "حلزون" }, { type: 'read', word: "صبح" }, { type: 'read', word: "حوض" }, { type: 'read', word: "مریض" } ] },
                    { title: "حدس تصویر", exercises: [ { type: 'pictureGuess', image: "حوله", correct: "حوله", options: ["قلم", "حوله", "میخ"] }, { type: 'pictureGuess', image: "حوض", correct: "حوض", options: ["حوض", "قلم", "دستمال"] }, { type: 'pictureGuess', image: "مریض", correct: "مریض", options: ["مریض", "چای", "حلزون"] } ] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "او با ____ نوشت. ", correct: "قلم", options: ["قلم", "میله", "حوض"] }, 
                        { type: 'fillBlank', sentence: "با ___ صورتم را تراشیدم.", correct: "ژیلت", options: ["ژیلت", "قلم", "حوله"] },
                        { type: 'fillBlank', sentence: "صبح ___ نوشیدم.", correct: "قهوه", options: ["قهوه", "سیب", "صبحانه"] },
                        { type: 'fillBlank', sentence: "زیر بوته ها ___ دیدم .", correct: "حلزون", options: ["ژله", "حلزون", "صبح"] }
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "بعضی – حوض – وضو – مریض – رضا – حضرت – حاضر – ضامن - حوله – حمّام – حلزون – حرف – حریف – محرّم – حسین – حسن" },
                        { type: 'dictation', text: "حسن هفته ای دو بار به حمّام می رود. حلزون حیوانی چسبناک است. صبح ها بعد از صبحانه احساس سیری می کنم.امام رضا ضامن آهو است. معلّم ضرب را در ریاضی به ما آموخت. پدر رضایت نامه ی ابوالفضل را برای اردو امضا کرد." },
                        { type: 'dictation', text: "بعضی وقت ها به ماهی های حوض نگاه می کنم. همیشه آرزو می کنم کاش به فضا سفر کنم. حضرت محمّد (ص)پیامبر اسلام است. مرضیه با مادرش وضو می گیرد.هر کس باید از حوله ی مخصوص خود استفاده کند. نام محلّه ما محلّه ی دکتر حسابی است. حشرات حیواناتی ریز و مزاحم هستند." },
                        { type: 'dictation', text: "حمله – حلیم – حرکت – حیوان – حشرات – محمّد – حیدر- حال –رحیم – حنا – حامد – احمد – صحبت – صلح -" }
                    ] }
                ]
            },
            {
                id: 20, title: "درس بیستم : ط ، ظ  ،غـ ـغـ ـغ غ", unlocked: true,
                sections: [
                    { title: "ترکیب صداها", exercises: [
					{ type: 'build', word: "حیاط" },
					{ type: 'build', word: "مطب" },
					{ type: 'build', word: "طلا" }, 
					{ type: 'build', word: "چراغ" },  
					{ type: 'build', word: "مرغ" },
					{ type: 'build', word: "ظلم" },
					{ type: 'build', word: "ظرف" } ]
					},
                    { title: "کلمه‌یابی", exercises: [ 
					{ type: 'choice', correct: "حیاط", options: ["حیاط", "حیاط", "هیاط"] },
					{ type: 'choice', correct: "مطب", options: ["مطب", "متب", "فطب"] },
					{ type: 'choice', correct: "طلا", options: ["طلا", "تلا", "علا"] },
                    { type: 'choice', correct: "چراغ", options: ["چراغ", "حراغ", "جراغ"] },
					{ type: 'choice', correct: "ظرف", options: ["ظرف", "ضرف", "زرف"] },
					{ type: 'choice', correct: "ظلم", options: ["ظلم", "ضلم", "زلم"] },
					{ type: 'choice', correct: "غریبه", options: ["غریبه", "قریبه", "غریب"] },
					{ type: 'choice', correct: "غذا", options: ["غذا", "غزا", "عذا"] }
					] },
                    { title: "روان‌خوانی", exercises: [ 
					{ type: 'read', word: "غذا" }, 
					{ type: 'read', word: "غریبه" },
					{ type: 'read', word: "حیاط" }, 
					{ type: 'read', word: "ظلم" },
					{ type: 'read', word: "مطب" },
					{ type: 'read', word: "چراغ" },
					{ type: 'read', word: "طلا" }
					] },									
                    { title: "حدس تصویر", exercises: [
					{ type: 'pictureGuess', image: "غذا", correct: "غذا", options: ["غذا", "آب", "نان"] },
					{ type: 'pictureGuess', image: "حیاط", correct: "حیاط", options: ["حیاط", "ظرف", "کاسه"] },
					{ type: 'pictureGuess', image: "غریبه", correct: "غریبه", options: ["غریبه", "دوست", "آشنا"] },
					{ type: 'pictureGuess', image: "طلا", correct: "طلا", options: ["طلا", "ظرف", "کاسه"] },
					{ type: 'pictureGuess', image: "چراغ", correct: "چراغ", options: ["چراغ", "طلا", "مطب"] },
					{ type: 'pictureGuess', image: "ظرف", correct: "ظرف", options: ["غذا", "ظرف", "غریبه"] }


					] },
                    { title: "کلمه گمشده", exercises: [ 
                        { type: 'fillBlank', sentence: "___ خوردم چون گرسنه بودم.", correct: "غذا", options: ["غذا", "آب", "تاب"] }, 
                        { type: 'fillBlank', sentence: "قهوه در ___ ریختم.", correct: "فنجان", options: ["فنجان", "بشقاب", "کاسه"] },
                        { type: 'fillBlank', sentence: "او یک ___ بود.", correct: "غریبه", options: ["غریبه", "دوست", "آشنا"] },
                        { type: 'fillBlank', sentence: "در سینما ___ دیدم.", correct: "فیلم", options: ["فیلم", "ماه", "خواب"] },
						{ type: 'fillBlank', sentence: "دستبند او از جنس ___ بود.", correct: "طلا", options: ["غریبه", "طلا", "حیاط"] },
						{ type: 'fillBlank', sentence: "اتاق تاریک بود پس __- را روشن کردم .", correct: "چراغ", options: ["چراغ", "دوست", "مطب"] },
						{ type: 'fillBlank', sentence: "در حیاط ما چند ___ وجود دارد. ", correct: "مرغ", options: ["مرغ", "طلا", "غذا"] }
						
						
						
                    ] },
                    { title: "املا", exercises: [
                        { type: 'dictation', text: "ظاهر – ظهر – اعظم – عظمت – ظلم – مواظبت –خدا حافظی - مغرب – غروب – غرب – غصّه – غمگین – غم – غذا – قورباغه- حیاط – طوطی – طبل – طاووس – طلب – طالبی – مطلب – وسط" },
                        { type: 'dictation', text: "خاطرات – وطن – قطار – طناب – خط – خطّاطی – خیّاط - غول – بغل – باغ – چراغ – دروغ – زاغ – کلاغ – داغ – غدیر - مواظب – حفاظت – ناظم – نظم – منظّم – ظالم – ظلمت – وظیفه – ظرف" },
                        { type: 'dictation', text: "اعظم وقت خداحافظی بسیار غمگین بود. مادر برای ظهر ماکارونی می پزد. ناظم با بچّه ها صحبت می کند.کلاغ روی شاخه قار قار می کرد. قورباغه در مرداب پرید. عید غدیر جشن جانشینی امام علی(ع) است.عطا به مطب پزشک رفت. خاطرات انقلاب شیرین است. طاووس و طوطی دو پرنده ی زیبا هستند." },
                        { type: 'dictation', text: "صدای سوت قطار از دور می آید. طاهره در حیاط بازی می کند. خیاط برای علی یک لباس زیبا دوخت. وطن عزیز ما ایران است.شلغم غذای خوبی برای بیمار است. مرغ دانه می خورد. مادر ظرف ها را منظّم روی جا ظرفی می گذارد. با مشاهده ی دنیا به عظمت آفرینش خدا پی می بریم. من از خواهرم مواظبت می کنم.حضرت علی اصغر فرزند امام حسین (ع) است." }
                    ] }
                ]
            }
        ];
        // --- DATA برای Gamification ---
        const achievementsList = [
            { id: 'champion', name: "قهرمان حروف!", description: "کامل کردن ۵ درس", icon: "trophy.png", condition: (state) => state.completedLessons >= 5 },
            { id: 'wordBuilder', name: "کلمه‌ساز حرفه‌ای!", description: "ساختن ۲۰ کلمه", icon: "hammer.png", condition: (state) => state.wordsBuilt >= 20 },
            { id: 'reader', name: "خواننده بی‌نظیر!", description: "خواندن ۱۰ کلمه", icon: "book.png", condition: (state) => state.wordsRead >= 10 },
            { id: 'master', name: "استاد الفبا!", description: "کامل کردن تمام ۲۰ درس", icon: "crown.png", condition: (state) => state.completedLessons >= 20 },
            { id: 'speedster', name: "سریع‌العمل!", description: "انجام ۵۰ تمرین", icon: "bolt.png", condition: (state) => state.totalExercises >= 50 }
        ];
        // --- STATE ---
        let currentLesson = null;
        let currentExercises = [];
        let currentExerciseIndex = 0;
        let draggedElement = null;
        let dragClone = null;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let isDragging = false;
        let audioContext = null;
        let usedSuccessSounds = [];
        const successSounds = ["bravo1.mp3", "bravo2.mp3", "bravo3.mp3", "bravo4.mp3"];
        let isActivated = false;
        let isDemoMode = false;
        // --- STATE جدید برای Gamification ---
        let playerState = {
            stars: 0,
            completedLessons: 0,
            totalExercises: 0,
            wordsBuilt: 0,
            wordsRead: 0,
            unlockedAchievements: []
        };
        // --- DOM Elements ---
        const pages = {
            activation: document.getElementById('activation-screen'),
            mainMenu: document.getElementById('main-menu'),
            lessonSections: document.getElementById('lesson-sections-screen'),
            game: document.getElementById('game-screen'),
            leaderboard: document.getElementById('leaderboard-screen'),
            achievements: document.getElementById('achievements-screen')
        };
        const modals = {
            success: document.getElementById('success-modal'),
            lessonComplete: document.getElementById('lesson-complete-modal'),
            shareWarning: document.getElementById('share-warning-modal'),
            lockedLesson: document.getElementById('locked-lesson-modal')
        };
        const elements = {
            activationCodeInput: document.getElementById('activation-code-input'),
            activateBtn: document.getElementById('activate-btn'),
            demoBtn: document.getElementById('demo-btn'),
            activationMessage: document.getElementById('activation-message'),
            lessonsGrid: document.getElementById('lessons-grid'),
            starCount: document.getElementById('star-count'),
            showLeaderboardBtn: document.getElementById('show-leaderboard-btn'),
            showAchievementsBtn: document.getElementById('show-achievements-btn'),
            lbTotalStars: document.getElementById('lb-total-stars'),
            lbCompletedLessons: document.getElementById('lb-completed-lessons'),
            lbTotalExercises: document.getElementById('lb-total-exercises'),
            lbWordsBuilt: document.getElementById('lb-words-built'),
            lbWordsRead: document.getElementById('lb-words-read'),
            backToMainFromLeaderboard: document.getElementById('back-to-main-from-leaderboard'),
            achievementsList: document.getElementById('achievements-list'),
            backToMainFromAchievements: document.getElementById('back-to-main-from-achievements'),
            backToMainMenuBtn: document.getElementById('back-to-main-menu'),
            sectionsLessonTitle: document.getElementById('sections-lesson-title'),
            sectionsGrid: document.getElementById('sections-grid'),
            backToSectionsBtn: document.getElementById('back-to-sections'),
            gameLessonTitle: document.getElementById('game-lesson-title'),
            wordImageContainer: document.getElementById('word-image-container'),
            buildWordGameEl: document.getElementById('build-word-game'),
            dropZonesContainer: document.getElementById('drop-zones'),
            letterBubblesContainer: document.getElementById('letter-bubbles'),
            choiceGameEl: document.getElementById('choice-game'),
            choiceOptionsContainer: document.getElementById('choice-options'),
            pictureGuessGameEl: document.getElementById('picture-guess-game'),
            pictureGuessOptionsContainer: document.getElementById('picture-guess-options'),
            fillBlankGameEl: document.getElementById('fill-blank-game'),
            sentenceBlankEl: document.getElementById('sentence-blank'),
            fillBlankOptionsContainer: document.getElementById('fill-blank-options'),
            dictationGameEl: document.getElementById('dictation-game'),
            dictationTextEl: document.getElementById('dictation-text'),
            prevDictationBtn: document.getElementById('prev-dictation-btn'),
            nextDictationBtn: document.getElementById('next-dictation-btn'),
            dictationCounterEl: document.getElementById('dictation-counter'),
            finishDictationBtn: document.getElementById('finish-dictation-btn'),
            modalWordEl: document.getElementById('modal-word'),
            modalStarsEarned: document.getElementById('modal-stars-earned'),
            nextExerciseBtn: document.getElementById('next-exercise-btn'),
            backToSectionsFromCompleteBtn: document.getElementById('back-to-sections-from-complete'),
            closeWarningBtn: document.getElementById('close-warning-btn'),
            modalActivationCode: document.getElementById('modal-activation-code'),
            modalActivateBtn: document.getElementById('modal-activate-btn'),
            modalDemoBtn: document.getElementById('modal-demo-btn'),
            closeLockedModalBtn: document.getElementById('close-locked-modal-btn'),
            modalActivationMessage: document.getElementById('modal-activation-message'),
            dynamicReadGameContainer: document.getElementById('dynamic-read-game-container')
        };
        // --- Images/Icons Data ---
        const exerciseImages = {
            "آب": `<img src="water.png" class="w-28 h-28 object-contain" alt="آب">`,
            "بابا": `<img src="father.png" class="w-32 h-32 object-contain" alt="بابا">`,
            "باد": `<img src="wind.png" class="w-28 h-28 object-contain" alt="باد">`,
            "داد": `<img src="justice.png" class="w-28 h-28 object-contain" alt="داد">`,
            "ادب": `<img src="manners.png" class="w-28 h-28 object-contain" alt="ادب">`,
            "آباد": `<img src="inhabited.png" class="w-28 h-28 object-contain" alt="آباد">`,
            "بَد": `<img src="bad.png" class="w-28 h-28 object-contain" alt="بَد">`,
            "اسب": `<img src="horse.png" class="w-28 h-28 object-contain" alt="اسب">`,
            "سبد": `<img src="basket.png" class="w-28 h-28 object-contain" alt="سبد">`,
            "آمد": `<img src="came.png" class="w-28 h-28 object-contain" alt="آمد">`,
            "بادام": `<img src="almond.png" class="w-28 h-28 object-contain" alt="بادام">`,
            "داس": `<img src="scythe.png" class="w-28 h-28 object-contain" alt="داس">`,
            "سام": `<img src="name_sam.png" class="w-28 h-28 object-contain" alt="سام">`,
            "توت": `<img src="mulberry.png" class="w-28 h-28 object-contain" alt="توت">`,
            "دوست": `<img src="friend.png" class="w-28 h-28 object-contain" alt="دوست">`,
            "دست": `<img src="hand.png" class="w-28 h-28 object-contain" alt="دست">`,
            "تاب": `<img src="spring_coil.png" class="w-28 h-28 object-contain" alt="تاب">`,
            "سوت": `<img src="whistle.png" class="w-28 h-28 object-contain" alt="سوت">`,
            "بود": `<img src="was.png" class="w-28 h-28 object-contain" alt="بود">`,
            "انار": `<img src="pomegranate.png" class="w-28 h-28 object-contain" alt="انار">`,
            "نان": `<img src="bread.png" class="w-28 h-28 object-contain" alt="نان">`,
            "باران": `<img src="rain.png" class="w-28 h-28 object-contain" alt="باران">`,
            "مادر": `<img src="mother.png" class="w-28 h-28 object-contain" alt="مادر">`,
            "برادر": `<img src="brother.png" class="w-28 h-28 object-contain" alt="برادر">`,
            "نَر": `<img src="male.png" class="w-28 h-28 object-contain" alt="نَر">`,
            "ایران": `<img src="iran.png" class="w-28 h-28 object-contain" alt="ایران">`,
            "سیب": `<img src="apple.png" class="w-28 h-28 object-contain" alt="سیب">`,
            "میز": `<img src="table.png" class="w-28 h-28 object-contain" alt="میز">`,
            "زیبا": `<img src="beautiful.png" class="w-28 h-28 object-contain" alt="زیبا">`,
            "بازی": `<img src="game.png" class="w-28 h-28 object-contain" alt="بازی">`,
            "آزاد": `<img src="free.png" class="w-28 h-28 object-contain" alt="آزاد">`,
            "شانه": `<img src="shoulder.png" class="w-28 h-28 object-contain" alt="شانه">`,
            "تراش": `<img src="shave.png" class="w-28 h-28 object-contain" alt="تراش">`,
            "آش": `<img src="ash_food.png" class="w-28 h-28 object-contain" alt="آش">`,
            "امشب": `<img src="tonight.png" class="w-28 h-28 object-contain" alt="امشب">`,
            "ستاره": `<img src="star.png" class="w-28 h-28 object-contain" alt="ستاره">`,
            "ماشین": `<img src="machine.png" class="w-28 h-28 object-contain" alt="ماشین">`,
            "امید": `<img src="hope.png" class="w-28 h-28 object-contain" alt="امید">`,
            "بُرد": `<img src="took.png" class="w-28 h-28 object-contain" alt="بُرد">`,
            "سُرمه": `<img src="kohl.png" class="w-28 h-28 object-contain" alt="سُرمه">`,
            "کُشت": `<img src="killed.png" class="w-28 h-28 object-contain" alt="کُشت">`,
            "مُژه": `<img src="eyelash.png" class="w-28 h-28 object-contain" alt="مُژه">`,
            "اُرْدَک": `<img src="duck.png" class="w-28 h-28 object-contain" alt="اُرْدَک">`,
            "کتاب": `<img src="book.png" class="w-28 h-28 object-contain" alt="کتاب">`,
            "کفش": `<img src="shoe.png" class="w-28 h-28 object-contain" alt="کفش">`,
            "کمر": `<img src="waist.png" class="w-28 h-28 object-contain" alt="کمر">`,
            "گل": `<img src="flower.png" class="w-28 h-28 object-contain" alt="گل">`,
            "گربه": `<img src="cat.png" class="w-28 h-28 object-contain" alt="گربه">`,
            "گاو": `<img src="cow.png" class="w-28 h-28 object-contain" alt="گاو">`,
            "لاله": `<img src="tulip.png" class="w-28 h-28 object-contain" alt="لاله">`,
            "لیوان": `<img src="glass.png" class="w-28 h-28 object-contain" alt="لیوان">`,
            "ماه": `<img src="moon.png" class="w-28 h-28 object-contain" alt="ماه">`,
            "نوزاد": `<img src="baby.png" class="w-28 h-28 object-contain" alt="نوزاد">`,
            "نخل": `<img src="palm_tree.png" class="w-28 h-28 object-contain" alt="نخل">`,
            "وزن": `<img src="weight.png" class="w-28 h-28 object-contain" alt="وزن">`,
            "ویلا": `<img src="villa.png" class="w-28 h-28 object-contain" alt="ویلا">`,
            "هوا": `<img src="air.png" class="w-28 h-28 object-contain" alt="هوا">`,
            "هیچ": `<img src="nothing.png" class="w-28 h-28 object-contain" alt="هیچ">`,
            "یخ": `<img src="ice.png" class="w-28 h-28 object-contain" alt="یخ">`,
            "یار": `<img src="friend_companion.png" class="w-28 h-28 object-contain" alt="یار">`,
            "چشم": `<img src="eye.png" class="w-28 h-28 object-contain" alt="چشم">`,
            "چرخ": `<img src="wheel.png" class="w-28 h-28 object-contain" alt="چرخ">`,
            "حیاط": `<img src="courtyard.png" class="w-28 h-28 object-contain" alt="حیاط">`,
            "حل": `<img src="solution.png" class="w-28 h-28 object-contain" alt="حل">`,
            "خرس": `<img src="bear.png" class="w-28 h-28 object-contain" alt="خرس">`,
            "خانه": `<img src="house.png" class="w-28 h-28 object-contain" alt="خانه">`,
            "جارو": `<img src="broom.png" class="w-28 h-28 object-contain" alt="جارو">`,
            "جوجه": `<img src="chick.png" class="w-28 h-28 object-contain" alt="جوجه">`,
            "ثمر": `<img src="fruit_samr.png" class="w-28 h-28 object-contain" alt="ثمر">`,
            "ثابت": `<img src="stable.png" class="w-28 h-28 object-contain" alt="ثابت">`,
            "صندوق": `<img src="box.png" class="w-28 h-28 object-contain" alt="صندوق">`,
            "صبح": `<img src="morning.png" class="w-28 h-28 object-contain" alt="صبح">`,
            "ضامن": `<img src="guarantor.png" class="w-28 h-28 object-contain" alt="ضامن">`,
            "ضبط": `<img src="record.png" class="w-28 h-28 object-contain" alt="ضبط">`,
            "طلا": `<img src="gold.png" class="w-28 h-28 object-contain" alt="طلا">`,
            "طلب": `<img src="request.png" class="w-28 h-28 object-contain" alt="طلب">`,
            "ظرف": `<img src="dish.png" class="w-28 h-28 object-contain" alt="ظرف">`,
            "ظروف": `<img src="dishes.png" class="w-28 h-28 object-contain" alt="ظروف">`,
            "عسل": `<img src="honey.png" class="w-28 h-28 object-contain" alt="عسل">`,
            "عمر": `<img src="age.png" class="w-28 h-28 object-contain" alt="عمر">`,
            "غذا": `<img src="food.png" class="w-28 h-28 object-contain" alt="غذا">`,
            "غریبه": `<img src="stranger.png" class="w-28 h-28 object-contain" alt="غریبه">`,
            "فنجان": `<img src="cup.png" class="w-28 h-28 object-contain" alt="فنجان">`,
            "فیلم": `<img src="movie.png" class="w-28 h-28 object-contain" alt="فیلم">`,
            "قلم": `<img src="pen.png" class="w-28 h-28 object-contain" alt="قلم">`,
            "قهوه": `<img src="coffee.png" class="w-28 h-28 object-contain" alt="قهوه">`,
            "ژیلت": `<img src="razor.png" class="w-28 h-28 object-contain" alt="ژیلت">`,
            "ژله": `<img src="jelly.png" class="w-28 h-28 object-contain" alt="ژله">`,
            "پدر": `<img src="father.png" class="w-32 h-32 object-contain" alt="پدر">`,
            "پا": `<img src="foot.png" class="w-28 h-28 object-contain" alt="پا">`,
			"داور": `<img src="referee.png" class="w-28 h-28 object-contain" alt="داور">`,
			"وزنه بردار": `<img src="weightlifter.png" class="w-28 h-28 object-contain" alt="وزنه بردار">`,
			"میوه": `<img src="Fruit.png" class="w-28 h-28 object-contain" alt="میوه">`,
			"سگ": `<img src="dog.png" class="w-28 h-28 object-contain" alt="سگ">`,
			"خرما": `<img src="dates.png" class="w-28 h-28 object-contain" alt="خرما">`,
			"برف": `<img src="Snow.png" class="w-28 h-28 object-contain" alt="برف">`,
			"رودخانه": `<img src="river.png" class="w-28 h-28 object-contain" alt="رودخانه">`,
			"آدم برفی": `<img src="snowman.png" class="w-28 h-28 object-contain" alt="آدم برفی">`,
			"درخت": `<img src="tree.png" class="w-28 h-28 object-contain" alt="درخت">`,
			"قوری": `<img src="teapot.png" class="w-28 h-28 object-contain" alt="قوری">`,
			"قند": `<img src="sugar.png" class="w-28 h-28 object-contain" alt="قند">`,
			"قایق": `<img src="Boat.png" class="w-28 h-28 object-contain" alt="قایق">`,
			"خورشید": `<img src="sun.png" class="w-28 h-28 object-contain" alt="خورشید">`,
			"نوک": `<img src="beak.png" class="w-28 h-28 object-contain" alt="نوک">`,
			"خوراک": `<img src="food.png" class="w-28 h-28 object-contain" alt="خوراک">`,
			"هلو": `<img src="peach.png" class="w-28 h-28 object-contain" alt="خوراک">`,
			"آهو": `<img src="Deer.png" class="w-28 h-28 object-contain" alt="آهو">`,
			"چوب": `<img src="Wood.png" class="w-28 h-28 object-contain" alt="چوب">`,
			"پژمرده": `<img src="wilted.png" class="w-28 h-28 object-contain" alt="پژمرده">`,
			"خواب": `<img src="sleep.png" class="w-28 h-28 object-contain" alt="خواب">`,
			"خواهر": `<img src="Sister.png" class="w-28 h-28 object-contain" alt="خواهر">`,
			"ژاله": `<img src="jale.png" class="w-28 h-28 object-contain" alt="ژاله">`,
			"منیژه": `<img src="manije.png" class="w-28 h-28 object-contain" alt="منیژه">`,
			"دکّان": `<img src="shop.png" class="w-28 h-28 object-contain" alt="دکّان">`,
			"بنّا": `<img src="Builder.png" class="w-28 h-28 object-contain" alt="بنّا">`,
			"نجّار": `<img src="carpenter.png" class="w-28 h-28 object-contain" alt="نجّار">`,
			"تشکّر": `<img src="Thanks.png" class="w-28 h-28 object-contain" alt="تشکّر">`,
			"اوّل": `<img src="First.png" class="w-28 h-28 object-contain" alt="اوّل">`,
			"کفّاش": `<img src="Shoemaker.png" class="w-28 h-28 object-contain" alt="کفّاش">`,
			"صابون": `<img src="soap.png" class="w-28 h-28 object-contain" alt="صابون">`,
			"صدف": `<img src="Shell.png" class="w-28 h-28 object-contain" alt="صدف">`,
			"اذان": `<img src="adhan.png" class="w-28 h-28 object-contain" alt="اذان">`,
			"ذرّت": `<img src="corn.png" class="w-28 h-28 object-contain" alt="ذرّت">`,
			"صورتی": `<img src="Pink.png" class="w-28 h-28 object-contain" alt="صورتی">`,
			"ساعت": `<img src="Hour.png" class="w-28 h-28 object-contain" alt="ساعت">`,
			"عصا": `<img src="Cane.png" class="w-28 h-28 object-contain" alt="عصا">`,
			"عبادت": `<img src="praying.png" class="w-28 h-28 object-contain" alt="عبادت">`,
			"ثانیه": `<img src="seconds.png" class="w-28 h-28 object-contain" alt="ثانیه">`,
			"مبعث": `<img src="ascension.png" class="w-28 h-28 object-contain" alt="مبعث">`,
			"صبح": `<img src="morning.png" class="w-28 h-28 object-contain" alt="صبح">`,
			"حوله": `<img src="towel.png" class="w-28 h-28 object-contain" alt="حوله">`,
			"حلزون": `<img src="snail.png" class="w-28 h-28 object-contain" alt="حلزون">`,
			"حوض": `<img src="Pool.png" class="w-28 h-28 object-contain" alt="حوض">`,
			"مریض": `<img src="sick.png" class="w-28 h-28 object-contain" alt="مریض">`,
			"مطب": `<img src="clinic.png" class="w-28 h-28 object-contain" alt="مطب">`,
			"چراغ": `<img src="light-bulb.png" class="w-28 h-28 object-contain" alt="چراغ">`,
			"مرغ": `<img src="Chicken.png" class="w-28 h-28 object-contain" alt="مرغ">`,
			"ظلم": `<img src="Injustice.png" class="w-28 h-28 object-contain" alt="ظلم">`,
            "default": `<div class="w-28 h-28 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400">?</div>`
        };
        const sectionIcons = {
            "ترکیب صداها": `<img src="build_word.png" class="w-10 h-10" alt="ترکیب صداها">`,
            "کلمه‌یابی": `<img src="find_word.png" class="w-10 h-10" alt="کلمه‌یابی">`,
            "روان‌خوانی": `<img src="read_aloud.png" class="w-10 h-10" alt="روان‌خوانی">`,
            "حدس تصویر": `<img src="guess_image.png" class="w-10 h-10" alt="حدس تصویر">`,
            "کلمه گمشده": `<img src="missing_word.png" class="w-10 h-10" alt="کلمه گمشده">`,
            "املا": `<img src="dictation.png" class="w-10 h-10" alt="املا">`
        };
        // --- Navigation & Render ---
        function showPage(pageName) {
            Object.values(pages).forEach(page => page.classList.remove('active'));
            pages[pageName].classList.add('active');
        }
        function showModal(modalName) {
            modals[modalName].classList.add('active');
        }
        function hideModal(modalName) {
            modals[modalName].classList.remove('active');
        }
        function showMainMenu() {
            renderMainMenu();
            updateStarsDisplay();
            showPage('mainMenu');
        }
        function awardStars(stars = 1) {
            playerState.stars += stars;
            playerState.totalExercises++;
            updateStarsDisplay();
            savePlayerState();
        }
        function updateStarsDisplay() {
            elements.starCount.textContent = playerState.stars;
            if (elements.lbTotalStars) elements.lbTotalStars.textContent = playerState.stars;
            if (elements.lbCompletedLessons) elements.lbCompletedLessons.textContent = `${playerState.completedLessons}/${lessons.length}`;
            if (elements.lbTotalExercises) elements.lbTotalExercises.textContent = playerState.totalExercises;
            if (elements.lbWordsBuilt) elements.lbWordsBuilt.textContent = playerState.wordsBuilt;
            if (elements.lbWordsRead) elements.lbWordsRead.textContent = playerState.wordsRead;
        }
        function checkAchievements() {
            let newAchievementUnlocked = false;
            achievementsList.forEach(achievement => {
                if (!playerState.unlockedAchievements.includes(achievement.id) && achievement.condition(playerState)) {
                    playerState.unlockedAchievements.push(achievement.id);
                    newAchievementUnlocked = true;
                }
            });
            if (newAchievementUnlocked) {
                savePlayerState();
                renderAchievements();
            }
        }
        function renderAchievements() {
            elements.achievementsList.innerHTML = '';
            achievementsList.forEach(achievement => {
                const isUnlocked = playerState.unlockedAchievements.includes(achievement.id);
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                card.innerHTML = `
                    <img src="${achievement.icon}" class="trophy-icon" alt="${achievement.name}">
                    <div class="flex-1 text-right">
                        <h3 class="font-bold text-lg">${achievement.name}</h3>
                        <p class="text-sm text-gray-600">${achievement.description}</p>
                    </div>
                    <div class="text-2xl">${isUnlocked ? '✅' : '🔒'}</div>
                `;
                elements.achievementsList.appendChild(card);
            });
        }
        function showLeaderboard() {
            updateStarsDisplay();
            showPage('leaderboard');
        }
        function showAchievements() {
            renderAchievements();
            showPage('achievements');
        }
        function renderMainMenu() {
            elements.lessonsGrid.innerHTML = '';
            lessons.forEach(lesson => {
                const isLocked = !isActivated && !isDemoMode && lesson.id > 5;
                const card = document.createElement('div');
                card.className = `lesson-card p-6 rounded-2xl text-white font-bold text-2xl shadow-lg cursor-pointer flex justify-between items-center card ${isLocked ? 'locked' : ''}`;
                const lockIcon = `<img src="lock.png" class="w-8 h-8" alt="قفل">`;
                const playIcon = `<img src="play.png" class="w-8 h-8" alt="پخش">`;
                // ✅ تغییر جدید: اصلاح ساختار برای جلوگیری از به هم ریختگی آیکون
                card.innerHTML = `<span class="min-w-0">${lesson.title}</span><span class="flex-shrink-0">${isLocked ? lockIcon : playIcon}</span>`;
                if (!isLocked) {
                    card.onclick = () => showLessonSections(lesson.id);
                } else {
                    card.onclick = () => showModal('lockedLesson');
                }
                elements.lessonsGrid.appendChild(card);
            });
        }
        function showLessonSections(lessonId) {
            if (isDemoMode && lessonId > 5) {
                showModal('lockedLesson');
                return;
            }
            currentLesson = lessons.find(l => l.id === lessonId);
            elements.sectionsLessonTitle.textContent = currentLesson.title;
            elements.sectionsGrid.innerHTML = '';
            currentLesson.sections.forEach((section, index) => {
                const sectionContainer = document.createElement('div');
                sectionContainer.className = 'section-card-container';
                const card = document.createElement('div');
                card.className = 'card bg-white p-5 rounded-2xl shadow-md cursor-pointer flex items-center gap-4';
                card.innerHTML = `
                    <div class="text-3xl">${sectionIcons[section.title]}</div>
                    <div class="flex-1"><h3 class="font-bold text-xl text-gray-700">${section.title}</h3></div>
                    <div><img src="arrow_back.png" class="w-8 h-8 text-indigo-300" alt="بازگشت"></div>`;
                card.onclick = () => startSection(section.exercises, index);
                if (section.completed) {
                    const completedIndicator = document.createElement('div');
                    completedIndicator.className = 'completed-indicator';
                    completedIndicator.innerHTML = '✓';
                    sectionContainer.appendChild(completedIndicator);
                }
                sectionContainer.appendChild(card);
                elements.sectionsGrid.appendChild(sectionContainer);
            });
            showPage('lessonSections');
        }
        // --- Game Logic ---
        function startSection(exercises, sectionIndex) {
            currentExercises = shuffle([...exercises]);
            currentExerciseIndex = 0;
            elements.gameLessonTitle.textContent = currentLesson.title;
            loadExercise(currentExerciseIndex, sectionIndex);
            showPage('game');
        }
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        function loadExercise(index, sectionIndex) {
            // ✅ Reset dictation button listeners to prevent state leaks from one section to another
            elements.prevDictationBtn.onclick = null;
            elements.nextDictationBtn.onclick = null;
            elements.finishDictationBtn.onclick = null;
            
            const exercise = currentExercises[index];
            const wordKey = exercise.word || exercise.correct || exercise.image;
            elements.dynamicReadGameContainer.innerHTML = '';
            
            elements.wordImageContainer.classList.remove('hidden');
            elements.buildWordGameEl.classList.add('hidden');
            elements.choiceGameEl.classList.add('hidden');
            elements.pictureGuessGameEl.classList.add('hidden');
            elements.fillBlankGameEl.classList.add('hidden');
            elements.dictationGameEl.classList.add('hidden');
            if (exercise.type === 'build') {
                elements.wordImageContainer.innerHTML = exerciseImages[wordKey] || exerciseImages["default"];
                elements.buildWordGameEl.classList.remove('hidden');
                loadBuildExercise(exercise);
            } else if (exercise.type === 'choice') {
                elements.wordImageContainer.innerHTML = exerciseImages[wordKey] || exerciseImages["default"];
                elements.choiceGameEl.classList.remove('hidden');
                loadChoiceExercise(exercise);
            } else if (exercise.type === 'read') {
                elements.wordImageContainer.innerHTML = exerciseImages[wordKey] || exerciseImages["default"];
                createAndLoadReadExercise(exercise, sectionIndex);
            } else if (exercise.type === 'pictureGuess') {
                elements.wordImageContainer.innerHTML = exerciseImages[wordKey] || exerciseImages["default"];
                elements.pictureGuessGameEl.classList.remove('hidden');
                loadPictureGuessExercise(exercise);
            } else if (exercise.type === 'fillBlank') {
                elements.wordImageContainer.innerHTML = exerciseImages[wordKey] || exerciseImages["default"];
                elements.fillBlankGameEl.classList.remove('hidden');
                loadFillBlankExercise(exercise);
            } else if (exercise.type === 'dictation') {
                elements.wordImageContainer.classList.add('hidden');
                elements.dictationGameEl.classList.remove('hidden');
                loadDictationExercise(currentExercises, index);
            }
        }
        function loadBuildExercise(exercise) {
            elements.dropZonesContainer.innerHTML = '';
            elements.letterBubblesContainer.innerHTML = '';
            const wordLetters = exercise.word.split('');
            wordLetters.forEach((letter, index) => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone flex items-center justify-center w-16 h-16 bg-gray-200 rounded-lg border-2 border-gray-400 text-transparent';
                dropZone.dataset.letter = letter;
                dropZone.dataset.index = index;
                dropZone.textContent = letter;
                elements.dropZonesContainer.appendChild(dropZone);
            });
            shuffle([...wordLetters]).forEach(letter => {
                const bubble = document.createElement('div');
                bubble.className = 'letter-bubble w-16 h-16 bg-yellow-300 flex items-center justify-center text-3xl font-bold shadow-md';
                bubble.textContent = letter;
                bubble.draggable = true;
                bubble.dataset.letter = letter;
                elements.letterBubblesContainer.appendChild(bubble);
            });
            addDragDropListeners();
        }
        function loadChoiceExercise(exercise) {
            elements.choiceOptionsContainer.innerHTML = '';
            shuffle([...exercise.options]).forEach(option => {
                const button = document.createElement('button');
                button.className = 'choice-btn w-full bg-blue-400 text-white font-bold text-2xl py-4 rounded-xl shadow-md hover:bg-blue-500 transition-all card';
                button.textContent = option;
                button.onclick = (e) => handleChoiceSelection(e, option, exercise.correct);
                elements.choiceOptionsContainer.appendChild(button);
            });
        }
        function loadPictureGuessExercise(exercise) {
            elements.pictureGuessOptionsContainer.innerHTML = '';
            shuffle([...exercise.options]).forEach(option => {
                const button = document.createElement('button');
                button.className = 'choice-btn w-full bg-blue-400 text-white font-bold text-2xl py-4 rounded-xl shadow-md hover:bg-blue-500 transition-all card';
                button.textContent = option;
                button.onclick = (e) => handlePictureGuessSelection(e, option, exercise.correct);
                elements.pictureGuessOptionsContainer.appendChild(button);
            });
        }
        function loadFillBlankExercise(exercise) {
            elements.fillBlankOptionsContainer.innerHTML = '';
            elements.sentenceBlankEl.textContent = exercise.sentence;
            shuffle([...exercise.options]).forEach(option => {
                const button = document.createElement('button');
                button.className = 'choice-btn w-full bg-blue-400 text-white font-bold text-2xl py-4 rounded-xl shadow-md hover:bg-blue-500 transition-all card';
                button.textContent = option;
                button.onclick = (e) => handleFillBlankSelection(e, option, exercise.correct);
                elements.fillBlankOptionsContainer.appendChild(button);
            });
        }
        function playSound(filename) {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            const audio = new Audio(`sounds/${filename}`);
            if (audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    audio.play().catch(e => console.log("خطا در پخش صوت:", e));
                });
            } else {
                audio.play().catch(e => console.log("خطا در پخش صوت:", e));
            }
        }
        function playRandomSuccessSound() {
            if (usedSuccessSounds.length === successSounds.length) {
                usedSuccessSounds = [];
            }
            const availableSounds = successSounds.filter(sound => !usedSuccessSounds.includes(sound));
            const randomIndex = Math.floor(Math.random() * availableSounds.length);
            const selectedSound = availableSounds[randomIndex];
            usedSuccessSounds.push(selectedSound);
            playSound(selectedSound);
        }
        function createAndLoadReadExercise(exercise, sectionIndex) {
            const readGameHTML = `
                <div id="read-game" class="flex flex-col items-center gap-4">
                    <p class="text-5xl font-bold text-gray-800" id="read-word">${exercise.word}</p>
                    <button id="read-aloud-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white p-4 rounded-full">
                        <img src="speaker.png" class="w-8 h-8" alt="بلندگو">
                    </button>
                    <button id="reading-done-btn" class="mt-6 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full">خواندم</button>
                </div>
            `;
            elements.dynamicReadGameContainer.innerHTML = readGameHTML;
            const readAloudBtn = document.getElementById('read-aloud-btn');
            const readingDoneBtn = document.getElementById('reading-done-btn');
            if (readAloudBtn) {
                readAloudBtn.onclick = () => {
                    playSound(`${exercise.word}.mp3`);
                };
            }
            if (readingDoneBtn) {
                readingDoneBtn.onclick = () => {
                    playRandomSuccessSound();
                    playerState.wordsRead++;
                    checkAchievements();
                    setTimeout(() => showSuccessModal(sectionIndex, 1), 1000);
                };
            }
        }
        function handleChoiceSelection(event, selectedOption, correctOption) {
            const button = event.target;
            elements.choiceOptionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
            if (selectedOption === correctOption) {
                button.classList.add('correct', 'bg-green-500');
                playRandomSuccessSound();
                setTimeout(() => showSuccessModal(undefined, 1), 1000);
            } else {
                button.classList.add('incorrect', 'bg-red-500');
                elements.choiceOptionsContainer.querySelectorAll('button').forEach(btn => {
                    if (btn.textContent === correctOption) btn.classList.add('bg-green-500');
                });
                setTimeout(() => loadExercise(currentExerciseIndex), 1500);
            }
        }
        function handlePictureGuessSelection(event, selectedOption, correctOption) {
            const button = event.target;
            elements.pictureGuessOptionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
            if (selectedOption === correctOption) {
                button.classList.add('correct', 'bg-green-500');
                playRandomSuccessSound();
                setTimeout(() => showSuccessModal(undefined, 1), 1000);
            } else {
                button.classList.add('incorrect', 'bg-red-500');
                elements.pictureGuessOptionsContainer.querySelectorAll('button').forEach(btn => {
                    if (btn.textContent === correctOption) btn.classList.add('bg-green-500');
                });
                setTimeout(() => loadExercise(currentExerciseIndex), 1500);
            }
        }
        function handleFillBlankSelection(event, selectedOption, correctOption) {
            const button = event.target;
            elements.fillBlankOptionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
            if (selectedOption === correctOption) {
                button.classList.add('correct', 'bg-green-500');
                playRandomSuccessSound();
                setTimeout(() => showSuccessModal(undefined, 1), 1000);
            } else {
                button.classList.add('incorrect', 'bg-red-500');
                elements.fillBlankOptionsContainer.querySelectorAll('button').forEach(btn => {
                    if (btn.textContent === correctOption) btn.classList.add('bg-green-500');
                });
                setTimeout(() => loadExercise(currentExerciseIndex), 1500);
            }
        }
        // --- Drag & Drop Logic ---
        function addDragDropListeners() {
            const bubbles = document.querySelectorAll('.letter-bubble');
            const dropZones = document.querySelectorAll('.drop-zone:not(.filled)');
            bubbles.forEach(bubble => {
                bubble.addEventListener('mousedown', startDrag);
                bubble.addEventListener('touchstart', handleTouchStart, { passive: false });
            });
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => e.preventDefault());
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('touchend', handleTouchDrop);
            });
            document.addEventListener('contextmenu', (e) => {
                if (isDragging) {
                    e.preventDefault();
                }
            });
        }
        function startDrag(e) {
            if (e.button !== 0) return;
            e.preventDefault();
            startDragProcess(e.target, e.clientX, e.clientY);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }
        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            moveDrag(e.clientX, e.clientY);
        }
        function stopDrag(e) {
            if (!isDragging) return;
            e.preventDefault();
            endDrag(e.clientX, e.clientY);
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }
        function handleTouchStart(e) {
            if (e.touches.length > 1) return;
            e.preventDefault();
            const touch = e.touches[0];
            startDragProcess(e.target, touch.clientX, touch.clientY);
            document.addEventListener('touchmove', handleTouchMove, { passive: false });
            document.addEventListener('touchend', handleTouchEnd);
        }
        function handleTouchMove(e) {
            if (!isDragging || e.touches.length > 1) return;
            e.preventDefault();
            const touch = e.touches[0];
            moveDrag(touch.clientX, touch.clientY);
        }
        function handleTouchEnd(e) {
            if (!isDragging) return;
            e.preventDefault();
            endDrag(parseInt(dragClone.style.left) || 0, parseInt(dragClone.style.top) || 0);
            document.removeEventListener('touchmove', handleTouchMove);
            document.removeEventListener('touchend', handleTouchEnd);
        }
        function startDragProcess(element, clientX, clientY) {
            draggedElement = element;
            isDragging = true;
            draggedElement.classList.add('dragging');
            dragClone = draggedElement.cloneNode(true);
            dragClone.classList.add('drag-clone');
            document.body.appendChild(dragClone);
            const rect = draggedElement.getBoundingClientRect();
            dragOffsetX = clientX - rect.left;
            dragOffsetY = clientY - rect.top;
            dragClone.style.width = `${rect.width}px`;
            dragClone.style.height = `${rect.height}px`;
            dragClone.style.left = `${rect.left}px`;
            dragClone.style.top = `${rect.top}px`;
            document.body.style.userSelect = 'none';
            document.body.style.webkitUserSelect = 'none';
        }
        function moveDrag(clientX, clientY) {
            if (!isDragging || !dragClone) return;
            dragClone.style.left = `${clientX - dragOffsetX}px`;
            dragClone.style.top = `${clientY - dragOffsetY}px`;
        }
        function endDrag(clientX, clientY) {
            if (!isDragging) return;
            isDragging = false;
            let dropTarget = null;
            const dropZones = document.querySelectorAll('.drop-zone:not(.filled)');
            for (const zone of dropZones) {
                const rect = zone.getBoundingClientRect();
                const zoneCenterX = rect.left + rect.width / 2;
                const zoneCenterY = rect.top + rect.height / 2;
                const distance = Math.sqrt(Math.pow(clientX - zoneCenterX, 2) + Math.pow(clientY - zoneCenterY, 2));
                const zoneRadius = Math.sqrt(Math.pow(rect.width, 2) + Math.pow(rect.height, 2)) / 2;
                if (distance < zoneRadius * 1.5) {
                    dropTarget = zone;
                    break;
                }
            }
            if (dropTarget) {
                dropLetter(dropTarget, draggedElement);
            } else {
                if (draggedElement) {
                    draggedElement.classList.add('shake');
                    setTimeout(() => draggedElement.classList.remove('shake'), 500);
                }
            }
            if (dragClone) {
                document.body.removeChild(dragClone);
                dragClone = null;
            }
            if (draggedElement) {
                draggedElement.classList.remove('dragging');
                draggedElement = null;
            }
            document.body.style.userSelect = '';
            document.body.style.webkitUserSelect = '';
        }
        function handleDrop(e) {
            e.preventDefault();
            const dropZone = e.target.closest('.drop-zone');
            if (dropZone && draggedElement) {
                dropLetter(dropZone, draggedElement);
            }
        }
        function handleTouchDrop(e) {
            const dropZone = e.target.closest('.drop-zone');
            if (dropZone && draggedElement) {
                const touch = e.changedTouches[0];
                const elementFromPoint = document.elementFromPoint(touch.clientX, touch.clientY);
                if (elementFromPoint && elementFromPoint.classList.contains('letter-bubble') && elementFromPoint.classList.contains('dragging')) {
                    dropLetter(dropZone, elementFromPoint);
                }
            }
        }
        function dropLetter(dropZone, letterElement) {
            if (dropZone.classList.contains('filled')) {
                letterElement.classList.add('shake');
                setTimeout(() => letterElement.classList.remove('shake'), 500);
                return;
            }
            const allZones = Array.from(elements.dropZonesContainer.children);
            const nextEmptyZoneIndex = allZones.findIndex(z => !z.classList.contains('filled'));
            const dropIndex = allZones.indexOf(dropZone);
            if (dropIndex !== nextEmptyZoneIndex) {
                letterElement.classList.add('shake');
                setTimeout(() => letterElement.classList.remove('shake'), 500);
                return;
            }
            if (letterElement.dataset.letter === dropZone.dataset.letter) {
                dropZone.textContent = letterElement.textContent;
                dropZone.classList.add('filled');
                dropZone.classList.remove('text-transparent');
                letterElement.style.display = 'none';
                checkWordCompletion();
            } else {
                letterElement.classList.add('shake');
                setTimeout(() => letterElement.classList.remove('shake'), 500);
            }
        }
        function checkWordCompletion() {
            const isComplete = Array.from(elements.dropZonesContainer.children).every(z => z.classList.contains('filled'));
            if (isComplete) {
                playRandomSuccessSound();
                playerState.wordsBuilt++;
                checkAchievements();
                setTimeout(() => showSuccessModal(undefined, 2), 1000);
            }
        }
        function showSuccessModal(sectionIndex, starsEarned = 1) {
            awardStars(starsEarned);
            const exercise = currentExercises[currentExerciseIndex];
            if (exercise.type === 'dictation') {
                elements.modalWordEl.textContent = "املا عالی بود!";
            } else {
                const word = exercise.word || exercise.correct;
                elements.modalWordEl.textContent = `«${word}» عالی بود!`;
            }
            elements.modalStarsEarned.textContent = `+${starsEarned} ⭐`;
            if (currentExerciseIndex >= currentExercises.length - 1) {
                if (sectionIndex !== undefined) {
                    currentLesson.sections[sectionIndex].completed = true;
                    saveProgress();
                    const allSectionsCompleted = currentLesson.sections.every(s => s.completed);
                    if (allSectionsCompleted) {
                        playerState.completedLessons++;
                        checkAchievements();
                    }
                }
                setTimeout(() => {
                    hideModal('success');
                    showModal('lessonComplete');
                }, 500);
            } else {
                showModal('success');
            }
        }
        function loadDictationExercise(exercises, startIndex) {
            let currentDictationIndex = startIndex;
            function updateDictationUI() {
                const currentText = exercises[currentDictationIndex] ? exercises[currentDictationIndex].text : "";
                elements.dictationTextEl.textContent = currentText;
                elements.dictationCounterEl.textContent = `املا ${currentDictationIndex + 1} از ${exercises.length}`;
                elements.prevDictationBtn.disabled = currentDictationIndex === 0;
                elements.nextDictationBtn.disabled = currentDictationIndex === exercises.length - 1;
            }
            elements.prevDictationBtn.onclick = () => {
                if (currentDictationIndex > 0) {
                    currentDictationIndex--;
                    updateDictationUI();
                }
            };
            elements.nextDictationBtn.onclick = () => {
                if (currentDictationIndex < exercises.length - 1) {
                    currentDictationIndex++;
                    updateDictationUI();
                }
            };
            elements.finishDictationBtn.onclick = () => {
                playRandomSuccessSound();
                // We consider finishing the dictation as completing the current exercise index.
                // The success modal will then advance to the next exercise if available.
                const sectionIndex = currentLesson.sections.findIndex(sec => sec.title === "املا");
                showSuccessModal(sectionIndex, 1);
            };
            updateDictationUI();
        }
        // --- Activation Logic ---
        function checkActivationStatus() {
            const savedCode = localStorage.getItem('alphabetApp_code');
            const isDemo = localStorage.getItem('alphabetApp_demo') === 'true';
            if (savedCode && activationCodes.includes(savedCode)) {
                isActivated = true;
                isDemoMode = false;
                showMainMenu();
            } else if (isDemo) {
                isActivated = false;
                isDemoMode = true;
                showMainMenu();
            } else {
                showPage('activation');
            }
        }
        function activateApp(code, isFromModal = false) {
            code = code.trim().toUpperCase();
            if (activationCodes.includes(code)) {
                localStorage.setItem('alphabetApp_code', code);
                localStorage.setItem('alphabetApp_activationTime', new Date().getTime().toString());
                localStorage.removeItem('alphabetApp_demo');
                isActivated = true;
                isDemoMode = false;
                if (isFromModal) {
                    elements.modalActivationMessage.textContent = "فعال‌سازی با موفقیت انجام شد!";
                    elements.modalActivationMessage.className = "text-center mt-4 min-h-[1.5em] text-green-500";
                    setTimeout(() => {
                        hideModal('lockedLesson');
                        showMainMenu();
                    }, 2000);
                } else {
                    elements.activationMessage.textContent = "فعال‌سازی با موفقیت انجام شد!";
                    elements.activationMessage.className = "text-center text-green-500 mt-4";
                    showModal('shareWarning');
                }
            } else {
                const message = "کد فعال‌سازی نامعتبر است.";
                if (isFromModal) {
                    elements.modalActivationMessage.textContent = message;
                    elements.modalActivationMessage.className = "text-center mt-4 min-h-[1.5em] text-red-500";
                } else {
                    elements.activationMessage.textContent = message;
                    elements.activationMessage.className = "text-center text-red-500 mt-4";
                }
            }
        }
        function startDemo() {
            localStorage.setItem('alphabetApp_demo', 'true');
            localStorage.removeItem('alphabetApp_code');
            isActivated = false;
            isDemoMode = true;
            showMainMenu();
        }
        // --- Event Listeners ---
        elements.backToMainMenuBtn.addEventListener('click', () => showPage('mainMenu'));
        elements.backToSectionsBtn.addEventListener('click', () => showLessonSections(currentLesson.id));
        elements.backToSectionsFromCompleteBtn.addEventListener('click', () => {
            hideModal('lessonComplete');
            showLessonSections(currentLesson.id);
        });
        elements.nextExerciseBtn.addEventListener('click', () => {
            currentExerciseIndex++;
            hideModal('success');
            loadExercise(currentExerciseIndex);
        });
        elements.showLeaderboardBtn.addEventListener('click', showLeaderboard);
        elements.showAchievementsBtn.addEventListener('click', showAchievements);
        elements.backToMainFromLeaderboard.addEventListener('click', () => showPage('mainMenu'));
        elements.backToMainFromAchievements.addEventListener('click', () => showPage('mainMenu'));
        elements.activateBtn.addEventListener('click', () => {
            const code = elements.activationCodeInput.value.trim();
            if (code) {
                activateApp(code, false);
            } else {
                elements.activationMessage.textContent = "لطفاً کد فعال‌سازی را وارد کنید.";
                elements.activationMessage.className = "text-center text-red-500 mt-4";
            }
        });
        elements.demoBtn.addEventListener('click', startDemo);
        elements.closeWarningBtn.addEventListener('click', () => {
            hideModal('shareWarning');
            showMainMenu();
        });
        elements.modalActivateBtn.addEventListener('click', () => {
            const code = elements.modalActivationCode.value.trim();
            if (code) {
                activateApp(code, true);
            } else {
                elements.modalActivationMessage.textContent = "لطفاً کد فعال‌سازی را وارد کنید.";
                elements.modalActivationMessage.className = "text-center mt-4 min-h-[1.5em] text-red-500";
            }
        });
        elements.modalDemoBtn.addEventListener('click', () => {
            hideModal('lockedLesson');
            startDemo();
        });
        elements.closeLockedModalBtn.addEventListener('click', () => {
            hideModal('lockedLesson');
        });
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadPlayerState();
            checkActivationStatus();
        });
        function saveProgress() {
            try {
                localStorage.setItem('alphabetApp_progress', JSON.stringify(lessons));
            } catch (e) {
                console.log('Error saving progress:', e);
            }
        }
        function loadProgress() {
            try {
                const savedProgress = localStorage.getItem('alphabetApp_progress');
                if (savedProgress) {
                    const parsedProgress = JSON.parse(savedProgress);
                    for (let i = 0; i < lessons.length && i < parsedProgress.length; i++) {
                        if (parsedProgress[i].sections) {
                            for (let j = 0; j < lessons[i].sections.length && j < parsedProgress[i].sections.length; j++) {
                                lessons[i].sections[j].completed = parsedProgress[i].sections[j].completed || false;
                            }
                        }
                    }
                    playerState.completedLessons = lessons.filter(lesson => 
                        lesson.sections.every(section => section.completed)
                    ).length;
                    updateStarsDisplay();
                    checkAchievements();
                }
            } catch (e) {
                console.log('Error loading progress:', e);
            }
        }
        loadProgress();
        function savePlayerState() {
            try {
                localStorage.setItem('alphabetApp_playerState', JSON.stringify(playerState));
            } catch (e) {
                console.log('Error saving player state:', e);
            }
        }
        function loadPlayerState() {
            try {
                const savedState = localStorage.getItem('alphabetApp_playerState');
                if (savedState) {
                    playerState = JSON.parse(savedState);
                    playerState.stars = playerState.stars || 0;
                    playerState.completedLessons = playerState.completedLessons || 0;
                    playerState.totalExercises = playerState.totalExercises || 0;
                    playerState.wordsBuilt = playerState.wordsBuilt || 0;
                    playerState.wordsRead = playerState.wordsRead || 0;
                    playerState.unlockedAchievements = playerState.unlockedAchievements || [];
                    updateStarsDisplay();
                    renderAchievements();
                }
            } catch (e) {
                console.log('Error loading player state:', e);
            }
        }
    </script>
</body>
</html>
